<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>[âœ¨Exploration Series] Kubernetes Authentications &amp; Authorization Mechanismds - p1nant0m</title><meta name="Description" content="p1nant0m"><meta property="og:title" content="[âœ¨Exploration Series] Kubernetes Authentications &amp; Authorization Mechanismds" />
<meta property="og:description" content="æœ€è¿‘åœ¨å­¦ä¹ äº‘åŸç”Ÿæœ€ä½³å®‰å…¨å®è·µï¼Œå…¶ä¸­æåˆ°äº† k8s ä¸­çš„è®¤è¯ä¸æˆæƒæ¨¡å—ï¼Œä¸ºäº†åŠ æ·±ç†è§£ä»¥åŠæœ‰å¯¹ k8s æºç é˜…è¯»çš„è®¡åˆ’ï¼Œä¾¿è¯ç”Ÿäº†è¿™ä¸ª[âœ¨æ¢ç´¢ç³»åˆ—]ã€‚æˆ‘ä»¬å°†ä»éœ€æ±‚å‡ºå‘çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ä¸ªç³»ç»Ÿéœ€è¦è®¾è®¡æˆè¿™ä¸ªæ ·å­ï¼Œè¿™ä¸ªæ¨¡å—ä»¥åŠåœ¨æºç å±‚é¢æ˜¯ä½•å¦‚å®ç°çš„ï¼Œè¿™æ ·çš„å®ç°æœ‰ä»€ä¹ˆäº®ç‚¹ä»¥åŠå·¥ç¨‹è€ƒé‡ï¼Œä¸ä»…å¦‚æ­¤ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜ä¼šç€é‡å…³æ³¨å…¶ä¸­ä¸å®‰å…¨ç›¸å…³çš„ç»†èŠ‚ï¼Œå…³æ³¨ç³»ç»Ÿçš„å…¨è²Œï¼Œé‡ç°æ€è€ƒå®‰å…¨ç³»ç»Ÿçš„æ„å»ºã€‚ ğŸŒ  æˆ‘æ˜¯è°ï¼Ÿæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿâ€”â€” è®¤è¯ä¸æˆæƒ è®¤è¯å’Œæˆæƒæ˜¯" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://p1nant0m.com/exploration-series-kubernetes-authenticationsa/" /><meta property="og:image" content="https://p1nant0m.com/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-30T12:00:00+00:00" />
<meta property="article:modified_time" content="2023-08-30T12:00:00+00:00" /><meta property="og:site_name" content="p1nant0m" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://p1nant0m.com/logo.png"/>

<meta name="twitter:title" content="[âœ¨Exploration Series] Kubernetes Authentications &amp; Authorization Mechanismds"/>
<meta name="twitter:description" content="æœ€è¿‘åœ¨å­¦ä¹ äº‘åŸç”Ÿæœ€ä½³å®‰å…¨å®è·µï¼Œå…¶ä¸­æåˆ°äº† k8s ä¸­çš„è®¤è¯ä¸æˆæƒæ¨¡å—ï¼Œä¸ºäº†åŠ æ·±ç†è§£ä»¥åŠæœ‰å¯¹ k8s æºç é˜…è¯»çš„è®¡åˆ’ï¼Œä¾¿è¯ç”Ÿäº†è¿™ä¸ª[âœ¨æ¢ç´¢ç³»åˆ—]ã€‚æˆ‘ä»¬å°†ä»éœ€æ±‚å‡ºå‘çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ä¸ªç³»ç»Ÿéœ€è¦è®¾è®¡æˆè¿™ä¸ªæ ·å­ï¼Œè¿™ä¸ªæ¨¡å—ä»¥åŠåœ¨æºç å±‚é¢æ˜¯ä½•å¦‚å®ç°çš„ï¼Œè¿™æ ·çš„å®ç°æœ‰ä»€ä¹ˆäº®ç‚¹ä»¥åŠå·¥ç¨‹è€ƒé‡ï¼Œä¸ä»…å¦‚æ­¤ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜ä¼šç€é‡å…³æ³¨å…¶ä¸­ä¸å®‰å…¨ç›¸å…³çš„ç»†èŠ‚ï¼Œå…³æ³¨ç³»ç»Ÿçš„å…¨è²Œï¼Œé‡ç°æ€è€ƒå®‰å…¨ç³»ç»Ÿçš„æ„å»ºã€‚ ğŸŒ  æˆ‘æ˜¯è°ï¼Ÿæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿâ€”â€” è®¤è¯ä¸æˆæƒ è®¤è¯å’Œæˆæƒæ˜¯"/>
<meta name="application-name" content="æˆ‘çš„ç½‘ç«™">
<meta name="apple-mobile-web-app-title" content="æˆ‘çš„ç½‘ç«™"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://p1nant0m.com/exploration-series-kubernetes-authenticationsa/" /><link rel="prev" href="https://p1nant0m.com/2023-07-16-hackthebox-busqueda/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[âœ¨Exploration Series] Kubernetes Authentications \u0026 Authorization Mechanismds",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/p1nant0m.com\/exploration-series-kubernetes-authenticationsa\/"
        },"genre": "posts","keywords": "Kubernetes, Auth \u0026 Authz","wordcount":  3690 ,
        "url": "https:\/\/p1nant0m.com\/exploration-series-kubernetes-authenticationsa\/","datePublished": "2023-08-30T12:00:00+00:00","dateModified": "2023-08-30T12:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "p1nant0m"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CX84EW6PHH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-CX84EW6PHH');
    </script>
    
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="p1nant0m"><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/about/"> å…³äº </a><a class="menu-item" href="/friends/"> å‹é“¾ </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="é€‰æ‹©è¯­è¨€">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/exploration-series-kubernetes-authenticationsa/" selected>ç®€ä½“ä¸­æ–‡</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CX84EW6PHH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-CX84EW6PHH');
    </script>

    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="p1nant0m"><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/about/" title="">å…³äº</a><a class="menu-item" href="/friends/" title="">å‹é“¾</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="é€‰æ‹©è¯­è¨€">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/exploration-series-kubernetes-authenticationsa/" selected>ç®€ä½“ä¸­æ–‡</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[âœ¨Exploration Series] Kubernetes Authentications & Authorization Mechanismds</h1><h2 class="single-subtitle">[âœ¨æ¢ç´¢ç³»åˆ—] kubernetes ä¸­çš„è®¤è¯ä¸æˆæƒæœºåˆ¶</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>p1nant0m</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-08-30">2023-08-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;çº¦ 3690 å­—&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;é¢„è®¡é˜…è¯» 8 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#-æˆ‘æ˜¯è°æˆ‘èƒ½åšä»€ä¹ˆ-è®¤è¯ä¸æˆæƒ">ğŸŒ  æˆ‘æ˜¯è°ï¼Ÿæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿâ€”â€” è®¤è¯ä¸æˆæƒ</a></li>
            <li><a href="#-overviews-in-kubernetes-authenticating-model">ğŸŒ„ Overviews In Kubernetes Authenticating Model</a></li>
            <li><a href="#-security-issues-related-to-super-privilege-serviceaccount">ğŸŒ  Security Issues Related to Super-Privilege Serviceaccount</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>æœ€è¿‘åœ¨å­¦ä¹ <strong>äº‘åŸç”Ÿæœ€ä½³å®‰å…¨å®è·µ</strong>ï¼Œå…¶ä¸­æåˆ°äº† k8s ä¸­çš„è®¤è¯ä¸æˆæƒæ¨¡å—ï¼Œä¸ºäº†åŠ æ·±ç†è§£ä»¥åŠæœ‰å¯¹ k8s æºç é˜…è¯»çš„è®¡åˆ’ï¼Œä¾¿è¯ç”Ÿäº†è¿™ä¸ª[âœ¨æ¢ç´¢ç³»åˆ—]ã€‚æˆ‘ä»¬å°†ä»éœ€æ±‚å‡ºå‘çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ä¸ªç³»ç»Ÿéœ€è¦è®¾è®¡æˆè¿™ä¸ªæ ·å­ï¼Œè¿™ä¸ªæ¨¡å—ä»¥åŠåœ¨æºç å±‚é¢æ˜¯ä½•å¦‚å®ç°çš„ï¼Œè¿™æ ·çš„å®ç°æœ‰ä»€ä¹ˆäº®ç‚¹ä»¥åŠå·¥ç¨‹è€ƒé‡ï¼Œä¸ä»…å¦‚æ­¤ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜ä¼šç€é‡å…³æ³¨å…¶ä¸­ä¸å®‰å…¨ç›¸å…³çš„ç»†èŠ‚ï¼Œå…³æ³¨ç³»ç»Ÿçš„å…¨è²Œï¼Œé‡ç°æ€è€ƒå®‰å…¨ç³»ç»Ÿçš„æ„å»ºã€‚</p>
<h4 id="-æˆ‘æ˜¯è°æˆ‘èƒ½åšä»€ä¹ˆ-è®¤è¯ä¸æˆæƒ">ğŸŒ  æˆ‘æ˜¯è°ï¼Ÿæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿâ€”â€” è®¤è¯ä¸æˆæƒ</h4>
<p>è®¤è¯å’Œæˆæƒæ˜¯è®¡ç®—æœºç½‘ç»œå®‰å…¨ä¸­çš„ä¸¤ä¸ªè€ç”Ÿå¸¸è°ˆçš„åŸºæœ¬é—®é¢˜ï¼Œå®ƒä»¬éƒ½æ—¨åœ¨ç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚ä¸ºäº†å®ç°è®¤è¯ä¸æˆæƒæœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³æŠ›å‡ºä¸¤ä¸ªé—®é¢˜è®©å¤§å®¶æ¥æ€è€ƒä¸€ä¸‹ï¼š1ï¼‰å¦‚ä½•è¯æ˜ä½ ï¼ˆä¸»ä½“ï¼‰çš„èº«ä»½ï¼Œ2ï¼‰å¦‚ä½•ç¡®ä¿ä½ ï¼ˆä¸»ä½“ï¼‰æ­£åœ¨è®¿é—®ï¼ˆè¡Œä¸ºï¼‰çš„èµ„æºï¼ˆå®¢ä½“ï¼‰æ˜¯<strong>åˆæ³•</strong>çš„ï¼Ÿ</p>
<p>å¯¹äºé—®é¢˜ï¼ˆ1ï¼‰å¦‚ä½•è¯æ˜ä½ ï¼ˆä¸»ä½“ï¼‰çš„èº«ä»½ï¼Œç»å…¸çš„è§£å†³æ€è·¯æœ‰ï¼ša) æä¾›åªæœ‰ä½ çŸ¥é“çš„ç§˜å¯†ï¼ˆå£ä»¤ï¼‰ï¼Œb) è®©ä¸€ä¸ªIdentity Providerç¬¬ä¸‰æ–¹ååŠ©ä½ è¯æ˜ä½ çš„èº«ä»½ï¼ˆOAuthï¼‰ï¼Œå¯¹äºé—®é¢˜ï¼ˆ2ï¼‰å¦‚ä½•ç¡®ä¿ä½ æ­£åœ¨è®¿é—®çš„èµ„æºæ˜¯åˆæ³•çš„ï¼Œè§£å†³æ€è·¯æ˜¯å»ºç«‹è®¿é—®æ§åˆ¶æ¨¡å‹ï¼Œå…¸å‹çš„è®¿é—®æ§åˆ¶æ¨¡å‹æœ‰ï¼ŒACL(Access-Control-List), RBAC(Role-Based-Access-Control), ABAC(Attribute-Based-Access-Control)ä»¥åŠNGAC(Next-Generation-Access-Control)ã€‚</p>
<p>å¯¹äºè®¤è¯è€Œè¨€ï¼Œä¸ºäº†è¾¾æˆä¸€ä¸ªä¼˜è‰¯çš„ç”¨æˆ·ä½“éªŒï¼ˆä¸éœ€è¦ç”¨æˆ·åœ¨è¿›è¡Œæ“ä½œæ—¶åå¤è¿›è¡Œè®¤è¯ï¼‰ï¼Œåœ¨å®è·µä¸­å¾€å¾€éœ€è¦å®ç°ä¸€ä¸ªå¯ä»¥åœ¨ä¸€ä¸ªæ—¶é—´å‘¨æœŸå†…å‘æœåŠ¡å™¨è¯æ˜è‡ªèº«å¹¶ç»´æŒå¯ä¿¡çŠ¶æ€çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶éœ€è¦æ•°æ®ä¿¡æ¯çš„æ”¯æ’‘ï¼Œæ ¹æ®æ•°æ®ä¿¡æ¯å­˜å‚¨ä½ç½®çš„ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†ä¸ºæœåŠ¡å™¨ä¾§ç»´æŠ¤ä»¥åŠç”¨æˆ·ä¾§ç»´æŠ¤ã€‚</p>
<p>ç”¨æˆ·ä¾§å­˜å‚¨å‡­è¯ç»´æŒæœºåˆ¶ï¼šBasic Tokenï¼ˆBase64ç¼–ç username:passwordï¼Œåœ¨æœåŠ¡å™¨ä¾§æ ¡éªŒå‡­è¯çš„åˆæ³•æ€§ï¼‰ï¼ŒBearer Token(æºå¸¦ç”¨æˆ·å‡­è¯ä½œä¸ºæ•°æ®è½½è·ï¼Œé€šè¿‡ç­¾åç®—æ³•å®ç°é˜²ç¯¡æ”¹ï¼‰ï¼ŒClient Certificateï¼ˆå®¢æˆ·ä¾§è¯ä¹¦ï¼Œç”±å¯ä¿¡ç›®æ ‡CAç­¾å‘ï¼Œä¸»ä½“æ‹¥æœ‰ç§é’¥è¯æ˜è‡ªèº«çš„åˆæ³•æ€§ï¼‰ã€‚</p>
<p>è§£æåçš„JWTç¤ºä¾‹ï¼ˆBearer Tokenï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="err">HEADER:ALGORITHM</span> <span class="err">&amp;</span> <span class="err">TOKEN</span> <span class="err">TYPE</span>
<span class="p">{</span>
  <span class="nt">&#34;alg&#34;</span><span class="p">:</span> <span class="s2">&#34;RS256&#34;</span><span class="p">,</span>
  <span class="nt">&#34;kid&#34;</span><span class="p">:</span> <span class="s2">&#34;VsVyOVilN85xFdtqJZMMTlkqpQA_WZgLAfg51igPox8&#34;</span>
<span class="p">}</span>

<span class="err">PAYLOAD:DATA</span>
<span class="p">{</span>
  <span class="nt">&#34;aud&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;https://kubernetes.default.svc.cluster.local&#34;</span>
  <span class="p">],</span>
  <span class="nt">&#34;exp&#34;</span><span class="p">:</span> <span class="mi">1667530848</span><span class="p">,</span>
  <span class="nt">&#34;iat&#34;</span><span class="p">:</span> <span class="mi">1667527248</span><span class="p">,</span>
  <span class="nt">&#34;iss&#34;</span><span class="p">:</span> <span class="s2">&#34;https://kubernetes.default.svc.cluster.local&#34;</span><span class="p">,</span>
  <span class="nt">&#34;kubernetes.io&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;namespace&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span><span class="p">,</span>
    <span class="nt">&#34;serviceaccount&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;cilium&#34;</span><span class="p">,</span>
      <span class="nt">&#34;uid&#34;</span><span class="p">:</span> <span class="s2">&#34;302b0155-6608-4b70-be4b-f7fb2bb73beb&#34;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;nbf&#34;</span><span class="p">:</span> <span class="mi">1667527248</span><span class="p">,</span>
  <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;system:serviceaccount:default:cilium&#34;</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>è§£æåçš„X509 Client Certificateç¤ºä¾‹ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Version:          3 (0x02)
Serial number:    1041774366814885730 (0x0e7520445e1bd762)
Algorithm ID:     SHA256withRSA
Validity
  Not Before:     22/08/2023 03:12:59 (dd-mm-yyyy hh:mm:ss) (230822031259Z)
  Not After:      21/08/2024 03:18:00 (dd-mm-yyyy hh:mm:ss) (240821031800Z)
Issuer
  CN = kubernetes
Subject
  O  = system:masters
  CN = kubernetes-admin
Public Key
  Algorithm:      RSA
  Length:         2048 bits
  Modulus:        bf:a4:cf:72:34:07:a7:0c:4b:db:19:2a:f7:60:10:68:
                  8b:52:db:e9:3f:24:d5:05:c5:4b:c7:f5:04:1e:01:d4:
                  2a:e5:a5:59:4e:66:6f:25:eb:9f:1b:a5:91:81:28:18:
                  7f:a3:fd:36:c5:45:e5:ea:ef:18:a0:f8:61:1a:bc:6b:
                  ee:d5:18:5e:3a:08:c0:11:d4:62:3c:40:18:6f:e6:56:
                  49:fe:01:5b:c5:56:f2:ab:4e:db:9f:96:4e:2f:e3:26:
                  56:39:4b:e8:08:7d:e3:9c:15:01:be:86:8b:ce:b4:8e:
                  7e:b7:1f:f9:98:4d:fc:13:7a:0a:f5:d1:bf:11:c7:4d:
                  11:41:d5:14:92:4a:3e:ef:c9:03:07:58:5a:49:31:df:
                  c6:21:64:b6:5e:2e:1a:f8:da:4e:1a:7e:1b:7b:48:10:
                  9c:93:05:bd:a1:9e:f8:2c:75:0a:1a:4b:c6:1c:11:95:
                  de:9a:7f:dd:12:9e:94:7a:68:07:4d:19:ed:fb:63:26:
                  aa:a4:0a:71:81:83:a0:ad:94:e8:1e:7b:cc:dc:39:3c:
                  ca:ae:bf:ba:50:57:37:87:a4:e9:b7:b1:1c:27:0a:18:
                  18:51:5c:55:28:87:0a:18:12:35:99:14:c4:10:53:37:
                  26:2d:fa:69:7e:b2:d8:8d:f1:dc:76:83:01:a7:81:e5
  Exponent:       65537 (0x10001)
Certificate Signature
  Algorithm:      SHA256withRSA
  Signature:      92:d7:99:22:91:2f:f3:ef:38:25:b4:ad:ea:7d:2c:b7:
                  a1:bb:cf:a4:eb:a0:f8:86:b9:ea:2b:e8:39:0e:0d:3c:
                  27:72:19:33:a1:69:e6:72:6b:f0:82:9e:f1:44:e6:0a:
                  1d:9b:55:58:e6:79:75:84:af:65:d2:5c:30:8d:1f:0e:
                  25:18:62:5a:9f:7e:0a:20:79:da:29:be:bc:16:3d:d2:
                  4e:fa:0f:13:c2:9a:5a:bb:98:32:55:ae:a3:bf:36:db:
                  00:fc:db:6a:ef:7e:09:f2:8a:aa:22:ca:90:db:b8:15:
                  70:5d:b2:1b:b6:b9:37:93:52:8c:d9:92:0f:38:97:bb:
                  93:c7:90:19:e7:c1:41:29:2f:7f:b8:02:03:07:43:47:
                  0a:6d:bb:f5:1f:e5:42:e2:22:19:6e:dc:e1:8e:fb:49:
                  c2:43:69:1a:85:1e:9e:99:9e:e3:85:83:91:15:e3:9c:
                  b8:17:7d:83:65:db:c8:03:ee:4a:1e:75:98:66:2f:e7:
                  86:40:ea:71:17:b8:34:bc:a4:b9:48:4b:1f:a3:42:c1:
                  a2:e7:70:b7:0d:25:7d:af:16:40:63:49:fd:d1:85:67:
                  1f:2b:5a:4e:25:cc:b9:a6:99:4b:5c:03:c0:ad:3c:e8:
                  97:d1:6b:29:74:5e:5b:a0:99:f1:09:69:f9:d8:59:aa

Extensions
  keyUsage CRITICAL:
    digitalSignature,keyEncipherment
  extKeyUsage :
    clientAuth
  basicConstraints CRITICAL:
    {}
  authorityKeyIdentifier :
    kid=d2003d36621e663f31e8b164d33f6dbf9433c371
</code></pre></td></tr></table>
</div>
</div><p>æœåŠ¡å™¨ä¾§å­˜å‚¨å‡­è¯ç»´æŒæœºåˆ¶ï¼šSessionIDï¼ˆä¸æºå¸¦ç”¨æˆ·å‡­è¯ï¼Œæ¯ä¸€ä¸ªIDç»‘å®šä¸€ä¸ªç”¨æˆ·å‡­è¯å¹¶ç”±æœåŠ¡å™¨åœ¨åå°è¿›è¡Œç®¡ç†ï¼‰ã€‚</p>
<p>ä¸¤è€…å®ç°æ–¹æ³•å„æœ‰åƒç§‹ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨Session IDéœ€è¦åœ¨æœåŠ¡å™¨ç«¯ç»´æŠ¤ä¼šè¯çŠ¶æ€ï¼Œè€ŒBearer Tokenå¯ä»¥ç›´æ¥å°†ä¸ç”¨æˆ·å‡­è¯ç›¸å…³çš„ä¿¡æ¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œä¸éœ€è¦æœåŠ¡å™¨ç«¯è¿›è¡Œä¼šè¯ç®¡ç†ï¼Œåªéœ€è¦åœ¨è¿›è¡Œç›¸å…³æ“ä½œæ—¶å¯¹Tokenè¿›è¡Œç­¾åçš„æ ¡éªŒï¼Œç¡®è®¤å…¶åˆæ³•æ€§å³å¯ã€‚</p>
<p>åœ¨æœ¬èŠ‚åˆæˆ‘ä»¬æåˆ°äº†<strong>åˆæ³•</strong>è¿™ä¸ªè¯ï¼Œè¿™ä¸ªè¯å¸¦æœ‰ä¸€ç‚¹å„¿æƒå¨ç¬¬ä¸‰æ–¹ä¸‹å®šä¹‰çš„å®šä¹‰çš„æ„å‘³ï¼Œæˆ‘ä»¬å§‘ä¸”æŠŠè¿™ä¸ªæƒå¨ç¬¬ä¸‰æ–¹ç§°ä½œç®¡ç†è€…ã€‚<strong>æˆæƒä¾¿æ˜¯ç”±ç®¡ç†è€…å†³å®šä¸»ä½“çš„å“ªäº›è¡Œä¸ºæ˜¯åˆæ³•çš„è¿‡ç¨‹</strong>ã€‚</p>
<p>ç®¡ç†è€…æä¾›å¯¹ä¸»ä½“ï¼ˆç”¨æˆ·ï¼‰è¿›è¡Œèº«ä»½è®¤è¯çš„æœºåˆ¶å¹¶ä¸ºå…¶æ‰€ç®¡ç†çš„å®¢ä½“ï¼ˆèµ„æºï¼‰åˆ¶å®šè®¿é—®è§„åˆ™ï¼Œç¡®ä¿åªæœ‰æ»¡è¶³è§„åˆ™ä¹‹ä¸‹çš„ä¸»ä½“æ‰èƒ½å¤Ÿå¯¹è¿™äº›å®¢ä½“ï¼ˆèµ„æºï¼‰è¿›è¡Œç›¸å…³çš„è¡Œä¸ºæ“ä½œã€‚è¿™æ ·çš„è§„åˆ™ä¸€èˆ¬ç”±ä¸€ä¸ªä¸‰å…ƒç»„ç»„æˆï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ä¸»ä½“ã€å®¢ä½“ä»¥åŠè¡Œä¸ºï¼Œä¸‹é¢å±•ç¤ºäº†ä¸€äº›æ ¹æ®ä¸åŒACæ¨¡å‹åˆ¶å®šçš„è§„åˆ™ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">|      Subject      |       Object                      |         Action
        Alice              /api/v1/*                                GET
        Admin                 *                                      *
        Guest            /api/v1/hello                              GET    
        
     [Bod, Danny]    [/api/v1/stock/*, /api/v1/db/*]           GET, POST, DELETE
        Watcher           [/api/v1/stock/*]                         GET
        Dannis              Watcher
        
      tag:age:&gt;22         /api/v1/secrets/*                         GET              
</code></pre></td></tr></table>
</div>
</div><p>æ­£ç¡®æ–½è¡Œçš„æˆæƒæœºåˆ¶ä¿éšœäº†ï¼š1ï¼‰ä¸ªäººæ•°æ®å’Œéšç§ä¸è¢«æ»¥ç”¨æˆ–æ³„éœ²ï¼Œ2ï¼‰ç¡®ä¿ç³»ç»Ÿå’Œæ•°æ®çš„å®‰å…¨ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®æˆ–æ”»å‡»ï¼Œ3ï¼‰ç¡®ä¿æ¯ä¸ªç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºåªèƒ½è®¿é—®å…¶æ‰€éœ€çš„èµ„æºæˆ–æ•°æ®ï¼Œè€Œä¸æ˜¯è¶…å‡ºå…¶æƒé™çš„å†…å®¹ï¼Œ4ï¼‰ç¡®ä¿æˆæƒäººè·å¾—é€‚å½“çš„è®¸å¯è¯æˆ–æƒé™ï¼Œä»¥ä½¿ç”¨å—é™åˆ¶çš„èµ„æºæˆ–æ•°æ®ã€‚</p>
<p>k8sä¸­çš„è®¤è¯ä¸é‰´æƒæœºåˆ¶ä¹Ÿä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€ç« èŠ‚ä¸­å°†çœ‹åˆ°k8sä¸Šçš„è®¤è¯ä¸é‰´æƒã€‚</p>
<h4 id="-overviews-in-kubernetes-authenticating-model">ğŸŒ„ Overviews In Kubernetes Authenticating Model</h4>
<p>å®éªŒç¯å¢ƒï¼š</p>
<p>Kind æ­å»º k8s é›†ç¾¤ï¼ŒHTTPie ä½œä¸º HTTP Clientï¼Œk9s å¯è§†åŒ–å‘½ä»¤è¡Œå·¥å…·ç®¡ç† k8s é›†ç¾¤ã€‚ä¸‹é¢ç»™å‡ºçš„æ˜¯æœ¬å®éªŒæ‰€ä½¿ç”¨åˆ°çš„ config.yamlï¼Œç”¨äºé…ç½® kind åˆ›å»º k8s é›†ç¾¤ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># config.yaml</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kind.x-k8s.io/v1alpha4</span><span class="w">
</span><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">k8s-exp</span><span class="w">
</span><span class="w"></span><span class="nt">nodes</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">control-plane</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>k8s ä¸­çš„è®¤è¯ç­–ç•¥ ï¼ˆ<a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/" target="_blank" rel="noopener noreffer ">Authentication Strategies</a>ï¼‰</p>
<ul>
<li><strong>X509 Client Certs</strong></li>
<li>Static Token File</li>
<li>Bootstrap Tokens</li>
<li><strong>Service Account Tokens</strong></li>
<li>OpenID Connect Tokens</li>
<li>Webhook Token Authentication</li>
<li>Authenticating Proxy</li>
</ul>
<blockquote>
<p>It is assumed that a cluster-independent service manages normal users in the following ways:</p>
<ul>
<li>an administrator distributing private keys</li>
<li>a user store like Keystone or Google Accounts</li>
<li>a file with a list of usernames and passwords</li>
</ul>
<p>**In this regard, **<em><strong>Kubernetes does not have objects which represent normal user accounts.</strong></em></p>
</blockquote>
<ul>
<li>ä½¿ç”¨ <strong>kubelet</strong>(credential in <code>.kube</code> directory) çš„èº«ä»½ä¸ <strong>apiserver</strong> è¿›è¡Œé€šä¿¡ ï¼ˆClient Certs | mTLSï¼‰</li>
<li>ä½¿ç”¨ system:serviceaccount:default:cilium èº«ä»½ä¸ <strong>apiserver</strong> è¿›è¡Œé€šä¿¡ ï¼ˆBearer Tokenï¼‰</li>
</ul>
<ol>
<li>Create ClusterRole [Cross Namespaces]</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># &#34;namespace&#34; omitted since ClusterRoles are not namespaced</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">secret-reader</span><span class="w">
</span><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">  </span><span class="c">#</span><span class="w">
</span><span class="w">  </span><span class="c"># at the HTTP level, the name of the resource for accessing Secret</span><span class="w">
</span><span class="w">  </span><span class="c"># objects is &#34;secrets&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;secrets&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;get&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;watch&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;list&#34;</span><span class="p">]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Create ServiceAccount</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kubectl create serviceaccount cilium
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Create ClusterRoleBinding</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span><span class="w"></span><span class="c"># This role binding allows &#34;dave&#34; to read secrets in the &#34;development&#34; namespace.</span><span class="w">
</span><span class="w"></span><span class="c"># You need to already have a ClusterRole named &#34;secret-reader&#34;.</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRoleBinding</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">read-secrets-global</span><span class="w">
</span><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cilium</span><span class="w"> </span><span class="c"># Name is case sensitive</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;default&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">secret-reader</span><span class="w">
</span><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>Create token for <em>system:serviceaccount:default:cilium</em></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kubectl create token cilium
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ServiceAccounts Using certificate to communicate with apiserver? Basic Steps (Guessing):</p>
<p>  1.Create Private Key and generate certificate.</p>
<p>  2.Create X509 certificates for client [/CN=&lsquo;system:serviceaccount:default:cilium&rsquo;]</p>
<p>  3.Generate csr and request CA to sign the certificate</p>
<p>  4.Building mTLS communication to the apiserver with the certificate </p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="http://image.p1nant0m.com/202309202126336.png"
        data-srcset="http://image.p1nant0m.com/202309202126336.png, http://image.p1nant0m.com/202309202126336.png 1.5x, http://image.p1nant0m.com/202309202126336.png 2x"
        data-sizes="auto"
        alt="http://image.p1nant0m.com/202309202126336.png"
        title="http://image.p1nant0m.com/202309202126336.png" /></p>
<p>é€šè¿‡ä¸Šè¿°æ“ä½œï¼Œä½äº [default] å‘½åç©ºé—´ä¸‹çš„ [cilium] <strong>ServiceAccount</strong> ä¾¿å¯ä»¥å¯¹é›†ç¾¤ç¯å¢ƒä¸­çš„æ‰€æœ‰ <strong>Secrets</strong> è¿›è¡Œ getã€watchã€list æ“ä½œäº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># request</span>
<span class="nv">$http</span> -A bearer -a eyJhbGciOiJSUzI1NiIsImtpZCI6IlZzVnlPVmlsTjg1eEZkdHFKWk1NVGxrcXBRQV9XWmdMQWZnNTFpZ1BveDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjY3NTMwODQ4LCJpYXQiOjE2Njc1MjcyNDgsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImNpbGl1bSIsInVpZCI6IjMwMmIwMTU1LTY2MDgtNGI3MC1iZTRiLWY3ZmIyYmI3M2JlYiJ9fSwibmJmIjoxNjY3NTI3MjQ4LCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDpjaWxpdW0ifQ.T8Hekf2GGRBfBpKeKZsgyTYJvCEsRbG-cIydmi9lQR7YEzT-_2zhyIto8cDphnbhGSAnyjz8Ia2LruW2FAHawKMZdkTUbigCsnE0adUcri1-lHbV4SYI-PSXGvktnDsEpaauqDVa3AmlTn_o35UnqQDMNed5-5DIFWm3AcqWwZthriSuEH9j8HiaMRtV8-4YuwcVZyQ6bANUGkOsYd_IOHnt1ZT9fJ2mJnWvOjjO7xjcUjcD38DtClwRdTD7pY_BDONw1TashsjXcYNIeXk7n5fBHkENgUktS_3HyRP-whkX2Td-SghZTTYYd7cLhMVYKZL1-kBdi0Q9R4LhEjalvA https://127.0.0.1:44257/api/v1/namespaces/default/pods<span class="se">\?</span>limit<span class="se">\=</span><span class="m">500</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># response</span>
<span class="o">{</span>
    <span class="s2">&#34;apiVersion&#34;</span>: <span class="s2">&#34;v1&#34;</span>,
    <span class="s2">&#34;items&#34;</span>: <span class="o">[]</span>,
    <span class="s2">&#34;kind&#34;</span>: <span class="s2">&#34;SecretList&#34;</span>,
    <span class="s2">&#34;metadata&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;resourceVersion&#34;</span>: <span class="s2">&#34;72253&#34;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä½¿ç”¨ <code>kubectl</code> å‘½ä»¤æ¥è§‚å¯Ÿå‘ <strong>apiserver</strong> è¯·æ±‚åˆ›å»ºä¸€ä¸ª <strong>secret</strong> æ—¶ï¼Œæ‰€æ„é€ çš„ HTTP æŠ¥æ–‡æ ¼å¼ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kubectl create secret generic top-secret --from-file<span class="o">=</span>topsecret.txt --namespace<span class="o">=</span>default -v<span class="o">=</span><span class="m">8</span>

<span class="o">{</span><span class="s2">&#34;kind&#34;</span>:<span class="s2">&#34;Secret&#34;</span>,<span class="s2">&#34;apiVersion&#34;</span>:<span class="s2">&#34;v1&#34;</span>,<span class="s2">&#34;metadata&#34;</span>:<span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;top-secret&#34;</span>,<span class="s2">&#34;namespace&#34;</span>:<span class="s2">&#34;default&#34;</span>,<span class="s2">&#34;creationTimestamp&#34;</span>:null<span class="o">}</span>,<span class="s2">&#34;data&#34;</span>:<span class="o">{</span><span class="s2">&#34;topsecret.txt&#34;</span>:<span class="s2">&#34;W1RPUCBTRUNSRVRdCg==&#34;</span><span class="o">}}</span>

POST https://127.0.0.1:44257/api/v1/namespaces/default/secrets
</code></pre></td></tr></table>
</div>
</div><p>ç›¸å…³çš„ RESTful API <a href="https://kubernetes.io/docs/reference/kubernetes-api/config-and-storage-resources/secret-v1/#create-create-a-secret" target="_blank" rel="noopener noreffer ">ç»†èŠ‚å¯ä»¥æŸ¥çœ‹</a>ï¼š</p>
<p>æˆ‘ä»¬ä½¿ç”¨ <em>system:serviceaccount:default:cilium</em> èº«ä»½å‘ <strong>apiserver</strong> å‘èµ·è¯·æ±‚ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">echo</span> -n <span class="s2">&#34;{&#34;</span>kind<span class="s2">&#34;:&#34;</span>Secret<span class="s2">&#34;,&#34;</span>apiVersion<span class="s2">&#34;:&#34;</span>v1<span class="s2">&#34;,&#34;</span>metadata<span class="s2">&#34;:{&#34;</span>name<span class="s2">&#34;:&#34;</span>top-secret<span class="s2">&#34;,&#34;</span>namespace<span class="s2">&#34;:&#34;</span>default<span class="s2">&#34;,&#34;</span>creationTimestamp<span class="s2">&#34;:null},&#34;</span>data<span class="s2">&#34;:{&#34;</span>topsecret.txt<span class="s2">&#34;:&#34;</span><span class="nv">W1RPUCBTRUNSRVRdCg</span><span class="o">==</span><span class="s2">&#34;}}&#34;</span> <span class="p">|</span> http -A bearer -a eyJhbGciOiJSUzI1NiIsImtpZCI6IlZzVnlPVmlsTjg1eEZkdHFKWk1NVGxrcXBRQV9XWmdMQWZnNTFpZ1BveDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjY3NTMwODQ4LCJpYXQiOjE2Njc1MjcyNDgsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImNpbGl1bSIsInVpZCI6IjMwMmIwMTU1LTY2MDgtNGI3MC1iZTRiLWY3ZmIyYmI3M2JlYiJ9fSwibmJmIjoxNjY3NTI3MjQ4LCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDpjaWxpdW0ifQ.T8Hekf2GGRBfBpKeKZsgyTYJvCEsRbG-cIydmi9lQR7YEzT-_2zhyIto8cDphnbhGSAnyjz8Ia2LruW2FAHawKMZdkTUbigCsnE0adUcri1-lHbV4SYI-PSXGvktnDsEpaauqDVa3AmlTn_o35UnqQDMNed5-5DIFWm3AcqWwZthriSuEH9j8HiaMRtV8-4YuwcVZyQ6bANUGkOsYd_IOHnt1ZT9fJ2mJnWvOjjO7xjcUjcD38DtClwRdTD7pY_BDONw1TashsjXcYNIeXk7n5fBHkENgUktS_3HyRP-whkX2Td-SghZTTYYd7cLhMVYKZL1-kBdi0Q9R4LhEjalvA  POST https://127.0.0.1:44257/api/v1/namespaces/default/secrets
</code></pre></td></tr></table>
</div>
</div><p>ä¸è¿‡æ³¨æ„åˆ°æˆ‘ä»¬å¹¶æ²¡æœ‰ <code>create secret</code> çš„æƒé™ï¼Œæˆ‘ä»¬è‹¥å°è¯• <code>create secret</code> åˆ™ä¼šæç¤º 401 é”™è¯¯ç ã€æœªæˆæƒçš„æ“ä½œã€‘ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">xxxxxxxxxxÂ HTTP/1.1 <span class="m">401</span> UnauthorizedAudit-Id: bdb8f7a5-84be-42b9-8d9b-8445c3bd3b85Cache-Control: no-cache, privateContent-Length: 129Content-Type: application/jsonDate: Fri, <span class="m">04</span> Nov <span class="m">2022</span> 11:09:15 GMTâ€‹<span class="o">{</span> Â  Â <span class="s2">&#34;apiVersion&#34;</span>: <span class="s2">&#34;v1&#34;</span>, Â  Â <span class="s2">&#34;code&#34;</span>: 401, Â  Â <span class="s2">&#34;kind&#34;</span>: <span class="s2">&#34;Status&#34;</span>, Â  Â <span class="s2">&#34;message&#34;</span>: <span class="s2">&#34;Unauthorized&#34;</span>, Â  Â <span class="s2">&#34;metadata&#34;</span>: <span class="o">{}</span>, Â  Â <span class="s2">&#34;reason&#34;</span>: <span class="s2">&#34;Unauthorized&#34;</span>, Â  Â <span class="s2">&#34;status&#34;</span>: <span class="s2">&#34;Failure&#34;</span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>kubectl</strong> ä½¿ç”¨ <code>/path/to/home/.kube/config</code> æ–‡ä»¶ä¸­çš„ç”¨æˆ·ç§é’¥ä¸è¯ä¹¦æ¥ä¸ <strong>apiserver</strong> è¿›è¡Œé€šä¿¡ï¼Œåœ¨ä½¿ç”¨ kind åˆ›å»ºé›†ç¾¤æ—¶ï¼Œkind-control-plane ä¸­çš„ <code>/etc/kubernetes</code> ç›®å½•ä¸‹æœ‰ <code>admin.conf</code> æ–‡ä»¶ï¼Œå…¶ä¸­çš„ç§é’¥ä¸è¯ä¹¦æ­£æ˜¯åœ¨ <strong>kubectl</strong> ä¸­ä½¿ç”¨åˆ°çš„ï¼Œkind ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€åˆ‡ï¼</p>
<ul>
<li>k9s ä¸‹é”®å…¥ groups å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°åä¸º system:master çš„ <strong>ClusterRoleBinding</strong> èµ„æºå¯¹è±¡ï¼Œå…¶å°† cluster-adminã€ClusterRoleã€‘ç»‘å®šåˆ°äº† system:mastersã€Groupã€‘ä¸Šã€‚</li>
<li>åœ¨ <code>/path/to/home/.kube/config</code> ä¸­çš„æ•°æ®ç»è¿‡äº† Base64 ç¼–ç ï¼Œè§£ç åå¯ä»¥å¾—åˆ° X509 åˆ¶å¼çš„è¯ä¹¦ã€‚</li>
</ul>
<blockquote>
<p>Kubernetes determines the username from the common name field in the &lsquo;subject&rsquo; of the cert (e.g., &ldquo;/CN=bob&rdquo;)</p>
</blockquote>
<p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Openssl è§£æç›¸å…³è¯ä¹¦ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„ <strong>Common Name Field</strong>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ k8s è¯­ä¹‰ä¸‹æ‰€è¯´çš„ç”¨æˆ·åï¼ˆæ³¨æ„ï¼šåœ¨ k8s ä¸­ï¼Œç”¨æˆ·æ‰€å±çš„ç»„åœ¨è¯ä¹¦ä¸­ç”¨ <strong>Organization Field</strong> è¡¨ç¤ºï¼‰ã€‚åœ¨ <code>config</code> æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹æ‰§è¡Œï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">$cat</span> config <span class="p">|</span> grep -oP <span class="s2">&#34;(?&lt;=client-certificate-data: ).*&#34;</span> <span class="p">|</span> base64 -d &gt;&gt; kubernetes-admin.crt <span class="o">&amp;&amp;</span> openssl x509 -in kubernetes-admin.crt -text <span class="o">&amp;&amp;</span> rm kubernetes-admin.crt
</code></pre></td></tr></table>
</div>
</div><p>æˆªå–è¯ä¹¦ä¸­çš„ç›¸å…³å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"> Subject: O = system:masters, CN = kubernetes-admin
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œè¯¥è¯ä¹¦ä»£è¡¨çš„â€œç”¨æˆ·åâ€ä¸º kubernetes-adminï¼Œæ‰€å±çš„&quot;ç”¨æˆ·ç»„&quot;ä¸º system:mastersï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šè¿°çš„åˆ†æå¯ä»¥çŸ¥é“ <strong>system:masters Group</strong> ä¸ <strong>cluster-admin ClusterRole</strong> ç»‘å®šï¼Œ<strong>system:masters</strong> ä¸­çš„æˆå‘˜å…·æœ‰æ“ä½œé›†ç¾¤ä¸­æ‰€æœ‰èµ„æºçš„æƒé™ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œk8s ä¸­å¹¶æ²¡æœ‰ä¸“é—¨ç”¨äºç»´æŠ¤ç”¨æˆ·è´¦æˆ·çš„ç»„ä»¶ï¼Œå…¶è·å–ç”¨æˆ·è´¦æˆ·çš„é€”å¾„æ˜¯åœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­é€šè¿‡å®¢æˆ·ç«¯è¯ä¹¦ä»¥åŠ token è§£æåå¯¹åº”çš„è´¦æˆ·å­—æ®µä¿¡æ¯è¡¨ç¤ºå½“å‰è·Ÿ <strong>apiserver</strong> è¿›è¡Œé€šä¿¡çš„å¯¹è±¡ï¼Œå…¶ä¿¡ä»»é€šä¿¡å¯¹ç­‰æ–¹æ˜¯å› ä¸ºå…¶æä¾›çš„è®¤è¯å‡­æ®ï¼ˆå®¢æˆ·ç«¯è¯ä¹¦ç”± <strong>apiserver</strong> å¯åŠ¨æ—¶æä¾›çš„ CA æ‰€ç­¾å‘ã€token æ ¡éªŒåˆæ³•ï¼‰åˆæ³•ã€‚å°±æ‹¿ <code>system:serviceaccount:default:cilium</code> çš„ token (JWT) æ¥çœ‹ï¼Œå…¶åœ¨è§£æåå…·æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;aud&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;https://kubernetes.default.svc.cluster.local&#34;</span>
  <span class="p">],</span>
  <span class="nt">&#34;exp&#34;</span><span class="p">:</span> <span class="mi">1667530848</span><span class="p">,</span>
  <span class="nt">&#34;iat&#34;</span><span class="p">:</span> <span class="mi">1667527248</span><span class="p">,</span>
  <span class="nt">&#34;iss&#34;</span><span class="p">:</span> <span class="s2">&#34;https://kubernetes.default.svc.cluster.local&#34;</span><span class="p">,</span>
  <span class="nt">&#34;kubernetes.io&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;namespace&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span><span class="p">,</span>
    <span class="nt">&#34;serviceaccount&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;cilium&#34;</span><span class="p">,</span>
      <span class="nt">&#34;uid&#34;</span><span class="p">:</span> <span class="s2">&#34;302b0155-6608-4b70-be4b-f7fb2bb73beb&#34;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;nbf&#34;</span><span class="p">:</span> <span class="mi">1667527248</span><span class="p">,</span>
  <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;system:serviceaccount:default:cilium&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>&ldquo;sub&rdquo;</strong> å­—æ®µä¾¿æ ‡è¯†äº†å¸¦æœ‰è¯¥ token è¯·æ±‚çš„ä¸»ä½“èº«ä»½ï¼Œ<strong>apiserver</strong> æ ¹æ®è¯¥èº«ä»½ä»¥åŠå…¶è¯·æ±‚çš„ç›¸åº”èµ„æºç»è¿‡æˆæƒæ¨¡å—ä»¥åŠå‡†å…¥æ§åˆ¶å™¨å¤„ç†åå‘è¯·æ±‚ä¸»ä½“è¿”å›å“åº”ç»“æœã€‚</p>
<blockquote>
<p>ğŸŒŸ <strong>Tips:</strong>
å…³äºç”¨æˆ·èº«ä»½ä¸»ä½“çš„å‘½åè§„åˆ™ï¼š&quot;<strong>system:serviceaccount</strong>&quot; ä»£è¡¨k8sä¸­çš„èµ„æºå¯¹è±¡ï¼Œ&quot;<strong>default</strong>&quot; ä»£è¡¨å‘½åç©ºé—´(namespace)ï¼Œ&quot;<strong>cilium</strong>&quot; ä»£è¡¨serviceaccountçš„å‘½å</p>
</blockquote>
<p>ServiceAccount-RoleBinding-ClusterRole æ“ä½œä»ç„¶ä¼šé™åˆ¶åœ¨ <strong>ServiceAccount</strong> æ‰€å¤„çš„ Namespace ä¸‹ï¼Œæœ€å°æƒé™äº¤é›†é›†åˆã€‚</p>
<p>ServiceAccount-ClusterRoleBinding-ClusterRole åˆ™èƒ½å¤Ÿåœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´ä¸­æ‰§è¡Œ Role æ‰€æˆæƒçš„æ“ä½œã€‚</p>
<p>Role &amp; ClusterRole || RoleBinding &amp; ClusterRoleBinding ã€subject:(User, Group, ServiceAccount) object(roleRef):(Role)ã€‘</p>
<p>ä½¿ç”¨ kubectl ä¸ apiServer è¿›è¡Œäº¤äº’æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå‘å‡ºè¯·æ±‚æ‰€ä½¿ç”¨çš„èº«ä»½æ˜¯ User å®ä½“ã€‚åœ¨æˆ‘çš„å®éªŒç¯å¢ƒä¸­ï¼Œåˆ™æ˜¯ç”¨æˆ· kind-kind å…¶åœ¨ Cluster ä¸­çš„ <strong>Role</strong> æ˜¯ <strong>cluster-amdin</strong>ï¼Œè¢«èµ‹äºˆäº†èƒ½å¤Ÿå¯¹æ‰€æœ‰èµ„æºæ‰§è¡Œä»»æ„æ“ä½œçš„æƒé™ã€‚kubectl åŠ è½½çš„é…ç½®æ–‡ä»¶é»˜è®¤ä½äº <code>/path/to/home/.kube</code> ä¸‹ï¼Œå…¶ä¸­å­˜æœ‰ kind-kind ç”¨æˆ·çš„è¯ä¹¦ä»¥åŠç§é’¥ä¿¡æ¯ï¼Œç”¨äºè¯æ˜å…¶èº«ä»½ï¼Œä¸‹é¢å±•ç¤ºçš„æ˜¯ç”¨æˆ·kind-kindçš„è¯ä¹¦ï¼Œå…¶ä¸­Subject-Oå­—æ®µä»£è¡¨å…¶æ‰€åœ¨çš„ç”¨æˆ·ç»„ï¼ŒSubject-CNä»£è¡¨å…¶åœ¨k8sç»´æŠ¤èµ„æºä¸­çš„ç”¨æˆ·åã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Version:          3 (0x02)
Serial number:    1041774366814885730 (0x0e7520445e1bd762)
Algorithm ID:     SHA256withRSA
Validity
  Not Before:     22/08/2023 03:12:59 (dd-mm-yyyy hh:mm:ss) (230822031259Z)
  Not After:      21/08/2024 03:18:00 (dd-mm-yyyy hh:mm:ss) (240821031800Z)
Issuer
  CN = kubernetes
Subject
  O  = system:masters
  CN = kubernetes-admin
Public Key
  Algorithm:      RSA
  Length:         2048 bits
  Modulus:        bf:a4:cf:72:34:07:a7:0c:4b:db:19:2a:f7:60:10:68:
                  8b:52:db:e9:3f:24:d5:05:c5:4b:c7:f5:04:1e:01:d4:
                  2a:e5:a5:59:4e:66:6f:25:eb:9f:1b:a5:91:81:28:18:
                  7f:a3:fd:36:c5:45:e5:ea:ef:18:a0:f8:61:1a:bc:6b:
                  ee:d5:18:5e:3a:08:c0:11:d4:62:3c:40:18:6f:e6:56:
                  49:fe:01:5b:c5:56:f2:ab:4e:db:9f:96:4e:2f:e3:26:
                  56:39:4b:e8:08:7d:e3:9c:15:01:be:86:8b:ce:b4:8e:
                  7e:b7:1f:f9:98:4d:fc:13:7a:0a:f5:d1:bf:11:c7:4d:
                  11:41:d5:14:92:4a:3e:ef:c9:03:07:58:5a:49:31:df:
                  c6:21:64:b6:5e:2e:1a:f8:da:4e:1a:7e:1b:7b:48:10:
                  9c:93:05:bd:a1:9e:f8:2c:75:0a:1a:4b:c6:1c:11:95:
                  de:9a:7f:dd:12:9e:94:7a:68:07:4d:19:ed:fb:63:26:
                  aa:a4:0a:71:81:83:a0:ad:94:e8:1e:7b:cc:dc:39:3c:
                  ca:ae:bf:ba:50:57:37:87:a4:e9:b7:b1:1c:27:0a:18:
                  18:51:5c:55:28:87:0a:18:12:35:99:14:c4:10:53:37:
                  26:2d:fa:69:7e:b2:d8:8d:f1:dc:76:83:01:a7:81:e5
  Exponent:       65537 (0x10001)
Certificate Signature
  Algorithm:      SHA256withRSA
  Signature:      92:d7:99:22:91:2f:f3:ef:38:25:b4:ad:ea:7d:2c:b7:
                  a1:bb:cf:a4:eb:a0:f8:86:b9:ea:2b:e8:39:0e:0d:3c:
                  27:72:19:33:a1:69:e6:72:6b:f0:82:9e:f1:44:e6:0a:
                  1d:9b:55:58:e6:79:75:84:af:65:d2:5c:30:8d:1f:0e:
                  25:18:62:5a:9f:7e:0a:20:79:da:29:be:bc:16:3d:d2:
                  4e:fa:0f:13:c2:9a:5a:bb:98:32:55:ae:a3:bf:36:db:
                  00:fc:db:6a:ef:7e:09:f2:8a:aa:22:ca:90:db:b8:15:
                  70:5d:b2:1b:b6:b9:37:93:52:8c:d9:92:0f:38:97:bb:
                  93:c7:90:19:e7:c1:41:29:2f:7f:b8:02:03:07:43:47:
                  0a:6d:bb:f5:1f:e5:42:e2:22:19:6e:dc:e1:8e:fb:49:
                  c2:43:69:1a:85:1e:9e:99:9e:e3:85:83:91:15:e3:9c:
                  b8:17:7d:83:65:db:c8:03:ee:4a:1e:75:98:66:2f:e7:
                  86:40:ea:71:17:b8:34:bc:a4:b9:48:4b:1f:a3:42:c1:
                  a2:e7:70:b7:0d:25:7d:af:16:40:63:49:fd:d1:85:67:
                  1f:2b:5a:4e:25:cc:b9:a6:99:4b:5c:03:c0:ad:3c:e8:
                  97:d1:6b:29:74:5e:5b:a0:99:f1:09:69:f9:d8:59:aa

Extensions
  keyUsage CRITICAL:
    digitalSignature,keyEncipherment
  extKeyUsage :
    clientAuth
  basicConstraints CRITICAL:
    {}
  authorityKeyIdentifier :
    kid=d2003d36621e663f31e8b164d33f6dbf9433c371

</code></pre></td></tr></table>
</div>
</div><h4 id="-security-issues-related-to-super-privilege-serviceaccount">ğŸŒ  Security Issues Related to Super-Privilege Serviceaccount</h4>
<p>[1] <a href="https://unit42.paloaltonetworks.com/gke-autopilot-vulnerabilities/" target="_blank" rel="noopener noreffer ">GKE-Autopilot Vulnerabilities</a></p>
<p>[2] <a href="https://www.paloaltonetworks.com/apps/pan/public/downloadResource?pagePath=/content/pan/en_US/resources/whitepapers/kubernetes-privilege-escalation-excessive-permissions-in-popular-platforms" target="_blank" rel="noopener noreffer ">Kubernetes Privilege Escalation Excessive Permissions in Popular Platforms</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2023-08-30</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/exploration-series-kubernetes-authenticationsa/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://p1nant0m.com/exploration-series-kubernetes-authenticationsa/" data-title="[âœ¨Exploration Series] Kubernetes Authentications &amp; Authorization Mechanismds" data-via="p1nant0m" data-hashtags="Kubernetes,Auth & Authz"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://p1nant0m.com/exploration-series-kubernetes-authenticationsa/" data-hashtag="Kubernetes"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://p1nant0m.com/exploration-series-kubernetes-authenticationsa/" data-title="[âœ¨Exploration Series] Kubernetes Authentications &amp; Authorization Mechanismds"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://p1nant0m.com/exploration-series-kubernetes-authenticationsa/" data-title="[âœ¨Exploration Series] Kubernetes Authentications &amp; Authorization Mechanismds"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://p1nant0m.com/exploration-series-kubernetes-authenticationsa/" data-title="[âœ¨Exploration Series] Kubernetes Authentications &amp; Authorization Mechanismds"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/kubernetes/">kubernetes</a>,&nbsp;<a href="/tags/auth-authz/">Auth &amp; Authz</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2023-07-16-hackthebox-busqueda/" class="prev" rel="prev" title="HacktheBox æ‰“é¶ä¹‹æ—…ï¼šbusqueda"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>HacktheBox æ‰“é¶ä¹‹æ—…ï¼šbusqueda</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">p1nant0m</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"ğŸ™‚P1nant0m","id-2":"ğŸ™‚P1nant0m"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
