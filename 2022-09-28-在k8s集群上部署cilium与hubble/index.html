<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble - p1nant0m</title><meta name="Description" content="p1nant0m"><meta property="og:title" content="åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble" />
<meta property="og:description" content="å…³äºç¬”è€… ç›®å‰ï¼Œç¬”è€…è¿˜æ˜¯ä¸€ååœ¨æ ¡å¤§å­¦ç”Ÿï¼Œå°±è¯»äºä¿¡æ¯å®‰å…¨ä¸“ä¸šï¼Œå¯¹äº‘åŸç”Ÿå®‰å…¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€è§‚æµ‹é¢†åŸŸæœ‰è¾ƒå¤§çš„å…´è¶£ã€‚å› è€Œå°ç«™ä¸Šçš„å¾ˆå¤šæ–‡ç« éƒ½æ˜¯èŒæ–°å­¦ä¹ è¸©å‘çš„ç»éªŒåˆ†äº«ï¼Œæ›´å¤šçš„æ˜¯â€œç©â€çš„å¿ƒæ€å‘ä¼˜ç§€ã€æœ‰è¶£çš„é¡¹ç›®ï¼Œå­¦ä¹ å…¶è®¾è®¡æ€è·¯ã€ç¼–ç é£æ ¼ã€æ–‡æ¡£ç¼–å†™ã€å¼€æºç¤¾åŒº/å›¢é˜Ÿåä½œæ–¹é¢çš„çŸ¥è¯†ï¼Œå¹¶è¾…ä»¥è‡ªå·±å°å°çš„è§è§£ã€‚ä½œä¸ºä¸€åè¿˜æœªæœ‰å……åˆ†ç»éªŒçš„ç”¨æˆ·ï¼Œæ–‡ç« ä¸­éš¾å…æœ‰æ‰€çº°æ¼ï¼Œè¿˜æœ›èƒ½å¤Ÿä¸å¤§å®¶äº¤æµå­¦ä¹ ï¼Œå…±å‹‰ã€‚ åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble è¿‘æ®µæ—¶é—´ä¸€ç›´åœ¨æ€è€ƒ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://p1nant0m.com/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" /><meta property="og:image" content="https://p1nant0m.com/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-27T14:57:27+00:00" />
<meta property="article:modified_time" content="2022-09-27T14:57:27+00:00" /><meta property="og:site_name" content="p1nant0m" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://p1nant0m.com/logo.png"/>

<meta name="twitter:title" content="åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble"/>
<meta name="twitter:description" content="å…³äºç¬”è€… ç›®å‰ï¼Œç¬”è€…è¿˜æ˜¯ä¸€ååœ¨æ ¡å¤§å­¦ç”Ÿï¼Œå°±è¯»äºä¿¡æ¯å®‰å…¨ä¸“ä¸šï¼Œå¯¹äº‘åŸç”Ÿå®‰å…¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€è§‚æµ‹é¢†åŸŸæœ‰è¾ƒå¤§çš„å…´è¶£ã€‚å› è€Œå°ç«™ä¸Šçš„å¾ˆå¤šæ–‡ç« éƒ½æ˜¯èŒæ–°å­¦ä¹ è¸©å‘çš„ç»éªŒåˆ†äº«ï¼Œæ›´å¤šçš„æ˜¯â€œç©â€çš„å¿ƒæ€å‘ä¼˜ç§€ã€æœ‰è¶£çš„é¡¹ç›®ï¼Œå­¦ä¹ å…¶è®¾è®¡æ€è·¯ã€ç¼–ç é£æ ¼ã€æ–‡æ¡£ç¼–å†™ã€å¼€æºç¤¾åŒº/å›¢é˜Ÿåä½œæ–¹é¢çš„çŸ¥è¯†ï¼Œå¹¶è¾…ä»¥è‡ªå·±å°å°çš„è§è§£ã€‚ä½œä¸ºä¸€åè¿˜æœªæœ‰å……åˆ†ç»éªŒçš„ç”¨æˆ·ï¼Œæ–‡ç« ä¸­éš¾å…æœ‰æ‰€çº°æ¼ï¼Œè¿˜æœ›èƒ½å¤Ÿä¸å¤§å®¶äº¤æµå­¦ä¹ ï¼Œå…±å‹‰ã€‚ åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble è¿‘æ®µæ—¶é—´ä¸€ç›´åœ¨æ€è€ƒ"/>
<meta name="application-name" content="æˆ‘çš„ç½‘ç«™">
<meta name="apple-mobile-web-app-title" content="æˆ‘çš„ç½‘ç«™"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://p1nant0m.com/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" /><link rel="prev" href="https://p1nant0m.com/2022-09-26-golang-%E9%9D%A2%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%AD%A6%E4%B9%A0.zh-ch/" /><link rel="next" href="https://p1nant0m.com/2022-10-08-%E4%BC%98%E9%9B%85%E7%9A%84%E5%88%9B%E5%BB%BA-cli-%E7%A8%8B%E5%BA%8F.zh-ch/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/p1nant0m.com\/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble\/"
        },"genre": "posts","keywords": "eBPF, kubernetes, cilium","wordcount":  4704 ,
        "url": "https:\/\/p1nant0m.com\/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble\/","datePublished": "2022-09-27T14:57:27+00:00","dateModified": "2022-09-27T14:57:27+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "p1nant0m"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CX84EW6PHH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-CX84EW6PHH');
    </script>
    
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="p1nant0m"><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/about/"> å…³äº </a><a class="menu-item" href="/friends/"> å‹é“¾ </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="é€‰æ‹©è¯­è¨€">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" selected>ç®€ä½“ä¸­æ–‡</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CX84EW6PHH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-CX84EW6PHH');
    </script>

    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="p1nant0m"><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/about/" title="">å…³äº</a><a class="menu-item" href="/friends/" title="">å‹é“¾</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="é€‰æ‹©è¯­è¨€">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" selected>ç®€ä½“ä¸­æ–‡</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble</h1><h2 class="single-subtitle">å®è·µå‡ºçœŸçŸ¥â€”â€”åœ¨ä½¿ç”¨ kind æ­å»ºçš„ k8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble</h2><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>p1nant0m</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-09-27">2022-09-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;çº¦ 4704 å­—&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;é¢„è®¡é˜…è¯» 10 åˆ†é’Ÿ&nbsp;<span id="/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" class="leancloud_visitors" data-flag-title="åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;æ¬¡é˜…è¯»
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#åœ¨-k8s-é›†ç¾¤ä¸Šéƒ¨ç½²-cilium-ä¸-hubble">åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble</a>
          <ul>
            <li><a href="#ä½¿ç”¨-kind-éƒ¨ç½²-k8s-é›†ç¾¤">ä½¿ç”¨ Kind éƒ¨ç½² K8s é›†ç¾¤</a></li>
            <li><a href="#å®‰è£…-cilium-cli-ç»ˆç«¯å¹¶åœ¨é›†ç¾¤ä¸­éƒ¨ç½²-cilium">å®‰è£… Cilium CLI ç»ˆç«¯å¹¶åœ¨é›†ç¾¤ä¸­éƒ¨ç½² Cilium</a></li>
            <li><a href="#å¯ç”¨-hubble-ui">å¯ç”¨ Hubble UI</a></li>
            <li><a href="#éƒ¨ç½²ä¸€äº›ç®€å•çš„-workload-star-wars-demoå¹¶åœ¨-hubble-ui-ä¸­è§‚å¯Ÿç½‘ç»œæµ">éƒ¨ç½²ä¸€äº›ç®€å•çš„ Workload ï¼ˆStar Wars Demoï¼‰å¹¶åœ¨ Hubble UI ä¸­è§‚å¯Ÿç½‘ç»œæµ</a></li>
            <li><a href="#ä½¿ç”¨-cilium-å¯¹-layer-3-4-7-æµé‡è¿›è¡Œæ§åˆ¶">ä½¿ç”¨ Cilium å¯¹ Layer 3, 4, 7 æµé‡è¿›è¡Œæ§åˆ¶</a>
              <ul>
                <li><a href="#åº”ç”¨-l3l4-å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥">åº”ç”¨ L3/L4 å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥</a></li>
                <li><a href="#åº”ç”¨-l7-å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥">åº”ç”¨ L7 å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div class="details admonition tip">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>å…³äºç¬”è€…<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">ç›®å‰ï¼Œç¬”è€…è¿˜æ˜¯ä¸€ååœ¨æ ¡å¤§å­¦ç”Ÿï¼Œå°±è¯»äºä¿¡æ¯å®‰å…¨ä¸“ä¸šï¼Œå¯¹äº‘åŸç”Ÿå®‰å…¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€è§‚æµ‹é¢†åŸŸæœ‰è¾ƒå¤§çš„å…´è¶£ã€‚å› è€Œå°ç«™ä¸Šçš„å¾ˆå¤šæ–‡ç« éƒ½æ˜¯èŒæ–°å­¦ä¹ è¸©å‘çš„ç»éªŒåˆ†äº«ï¼Œæ›´å¤šçš„æ˜¯â€œç©â€çš„å¿ƒæ€å‘ä¼˜ç§€ã€æœ‰è¶£çš„é¡¹ç›®ï¼Œå­¦ä¹ å…¶è®¾è®¡æ€è·¯ã€ç¼–ç é£æ ¼ã€æ–‡æ¡£ç¼–å†™ã€å¼€æºç¤¾åŒº/å›¢é˜Ÿåä½œæ–¹é¢çš„çŸ¥è¯†ï¼Œå¹¶è¾…ä»¥è‡ªå·±å°å°çš„è§è§£ã€‚ä½œä¸ºä¸€åè¿˜æœªæœ‰å……åˆ†ç»éªŒçš„ç”¨æˆ·ï¼Œæ–‡ç« ä¸­éš¾å…æœ‰æ‰€çº°æ¼ï¼Œè¿˜æœ›èƒ½å¤Ÿä¸å¤§å®¶äº¤æµå­¦ä¹ ï¼Œå…±å‹‰ã€‚</div>
        </div>
    </div>
<h3 id="åœ¨-k8s-é›†ç¾¤ä¸Šéƒ¨ç½²-cilium-ä¸-hubble">åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble</h3>
<p>è¿‘æ®µæ—¶é—´ä¸€ç›´åœ¨æ€è€ƒä¸ç ”ç©¶äº‘åŸç”Ÿä¸­åº”ç”¨çš„ç½‘ç»œã€æ€§èƒ½ä¸è¡Œä¸ºç›‘æ§/æ§åˆ¶å¹³å°ï¼ŒCilium ä½œä¸º CNCF ä¸­çš„åèµ·ä¹‹ç§€ï¼Œåˆ©ç”¨eBPF æä¾›å¯¹äºå†…æ ¸è¡Œä¸ºè§‚æµ‹çš„å¼ºå¤§èƒ½åŠ›ï¼Œå®ç°äº† K8s é›†ç¾¤å·¥ä½œè´Ÿè½½çš„ç½‘ç»œã€å¯è§‚æµ‹æ€§ä»¥åŠå®‰å…¨ï¼Œå®ƒçš„å®ç°æ–¹å¼ä»¥åŠæ¶æ„æ€è·¯ç»™äº†æˆ‘æå¤§çš„å¯å‘ã€‚ä¸‹å›¾ç»™å‡ºäº† Cilium çš„åŸºæœ¬æ¶æ„ï¼Œ</p>
<figure><a class="lightgallery" href="https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg" title="https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg" data-thumbnail="https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg" data-sub-html="<h2>Cilium åŸºæœ¬æ¶æ„</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg"
            data-srcset="https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg, https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg 1.5x, https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg 2x"
            data-sizes="auto"
            alt="https://cilium.io/static/diagram-9836e6891afc6fcbf30b85b31ca2b37e.svg" />
    </a><figcaption class="image-caption">Cilium åŸºæœ¬æ¶æ„</figcaption>
    </figure>
<h4 id="ä½¿ç”¨-kind-éƒ¨ç½²-k8s-é›†ç¾¤">ä½¿ç”¨ Kind éƒ¨ç½² K8s é›†ç¾¤</h4>
<p>æˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼å»åˆ›å»º K8s é›†ç¾¤ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»…ä½œä¸ºä¸€ä¸ª demo æ¥å»å¯¹ Cilium è¿›è¡Œè€ƒå¯Ÿï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æœ€ç®€å•çš„æ–¹å¼å»éƒ¨ç½² K8s é›†ç¾¤ï¼Œå®ƒä¸ºæˆ‘ä»¬å…å»äº†è®¸å¤šå¯¹é›†ç¾¤ç¹ççš„é…ç½®ï¼Œçš†åœ¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿçš„æ­å»ºä¸€ä¸ªé›†ç¾¤ï¼Œå¹¶é€šè¿‡è¿™ä¸ªç®€æ˜“é›†ç¾¤æ¥æµ‹è¯•è‡ªå·±çš„äº‘åŸç”Ÿåº”ç”¨ã€‚æƒ³è¦è¯¦ç»†äº†è§£ <a href="https://kind.sigs.k8s.io/" target="_blank" rel="noopener noreffer ">Kind</a> çš„å¯ä»¥ç‚¹å‡»æ­¤å¤„ï¼Œæˆ‘ä»¬è¿™é‡Œä»…ä½¿ç”¨å…¶è¿›è¡Œå¿«é€Ÿé›†ç¾¤åˆ›å»ºã€‚</p>
<p>åœ¨ Cilium çš„å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºäº†ä½¿ç”¨ Kind æ¥åˆ›å»ºé›†ç¾¤æ‰€ä½¿ç”¨çš„å‘½ä»¤ï¼Œæˆ‘ä»¬ä¼šè·Ÿéšç€æ–‡æ¡£æ¥ä¸€æ­¥æ­¥çš„åˆ›å»ºä½¿ç”¨ Cilium ä½œä¸º CNI ç»„ä»¶çš„ K8s é›†ç¾¤ã€‚</p>
<blockquote>
<p>é‰´äºå›½å†…ç‰¹æ®Šçš„ç½‘ç»œç¯å¢ƒæƒ…å†µï¼Œåœ¨åˆ›å»ºé›†ç¾¤æˆ–åœ¨ apply yaml çš„æ—¶å€™ä¼šå‡ºç°å¾ˆå¤šå› ç½‘ç»œé—®é¢˜å¯¼è‡´çš„é”™è¯¯ï¼Œè¿™é‡Œä¹Ÿä¼šç»™å‡ºç¬”è€…è‡ªå·±æ‘¸ç´¢å‡ºæ¥çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™å¯èƒ½ä¸æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆä½†æ˜¯å®ƒå¯è¡Œã€‚ğŸ˜Š</p>
</blockquote>
<p>æˆ‘ä»¬ç›´æ¥å¤åˆ¶ Cilium æ–‡æ¡£ä¸­ç»™å‡ºçš„å‘½ä»¤ï¼Œä½¿ç”¨ Kind åˆ›å»º K8s é›†ç¾¤ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">curl -LO https://raw.githubusercontent.com/cilium/cilium/1.12.0/Documentation/gettingstarted/kind-config.yaml
kind create cluster --config<span class="o">=</span>kind-config.yaml
</code></pre></td></tr></table>
</div>
</div><p>ç¨å¾®çœ‹ä¸€ä¸‹ç”¨æˆ·åˆ›å»ºé›†ç¾¤çš„ yaml æ–‡ä»¶é…ç½®ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kind.x-k8s.io/v1alpha4</span><span class="w">
</span><span class="w"></span><span class="nt">nodes</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">control-plane</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span><span class="w"></span><span class="nt">networking</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">disableDefaultCNI</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯ä»¥æ ¹æ®éœ€è¦å’Œæœºå™¨æ€§èƒ½å¢æ·»æˆ–åˆ å‡å·¥ä½œèŠ‚ç‚¹çš„æ•°é‡ï¼Œç¬”è€…åœ¨è¿™é‡Œä¾¿ä½¿ç”¨å®˜æ–¹ç»™å‡ºçš„å®šä¹‰ã€‚åœ¨æˆ‘ä»¬æ‰§è¡Œç¬¬äºŒæ¡å‘½ä»¤å kind ä¼šä½¿ç”¨ docker æ‹‰å–å¯¹åº”çš„é•œåƒï¼Œä½† kind ä¸­å¹¶ä¸ä¼šæ˜¾ç¤ºæ‹‰å–çš„è¿›åº¦ï¼Œä½ å¯ä»¥è‡ªè¡Œä½¿ç”¨ <code>docker pull</code> æ‹‰å–å¯¹åº”ç‰ˆæœ¬çš„ kind é•œåƒå¹¶ç¡®è®¤ä½ çš„ç½‘ç»œç¯å¢ƒæ˜¯å¦èƒ½å¤Ÿè®¿é—®å¯¹åº”çš„ä»“åº“ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºçš„ k8s é›†ç¾¤ä¸­ï¼Œé»˜è®¤çš„ CNI æ’ä»¶å·²ç»è¢« <strong>disable</strong>ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€æ­¥ä¸­å®‰è£…çš„ Cilium ä¼šæä¾›ç›¸åº”çš„ CNI å®ç°ã€‚</p>
<p>è‹¥ä¸€åˆ‡çš„é¡ºåˆ©æ‰§è¡Œï¼Œä½ çš„ K8s é›†ç¾¤ä¾¿ä¼šè¢«é¡ºåˆ©åˆ›å»ºï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>kubectl cluster-info</code> æŸ¥çœ‹ä½ çš„é›†ç¾¤æ˜¯å¦å·²æˆåŠŸéƒ¨ç½²ï¼Œ</p>
<figure><a class="lightgallery" href="https://image.p1nant0m.com/202209281510675.png" title="https://image.p1nant0m.com/202209281510675.png" data-thumbnail="https://image.p1nant0m.com/202209281510675.png" data-sub-html="<h2>kubectl cluster-info å‘½ä»¤æ‰§è¡Œæƒ…å†µ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://image.p1nant0m.com/202209281510675.png"
            data-srcset="https://image.p1nant0m.com/202209281510675.png, https://image.p1nant0m.com/202209281510675.png 1.5x, https://image.p1nant0m.com/202209281510675.png 2x"
            data-sizes="auto"
            alt="https://image.p1nant0m.com/202209281510675.png" />
    </a><figcaption class="image-caption">kubectl cluster-info å‘½ä»¤æ‰§è¡Œæƒ…å†µ</figcaption>
    </figure>
<p>ä½¿ç”¨ <code>docker ps</code> å‘½ä»¤æŸ¥çœ‹åœ¨æœ¬åœ°æœºå™¨ä¸Šå·²ç»å¯åŠ¨äº†çš„å·¥ä½œèŠ‚ç‚¹ä»¥åŠæ§åˆ¶å¹³é¢ï¼Œ</p>
<figure><a class="lightgallery" href="https://image.p1nant0m.com/202209281510146.png" title="https://image.p1nant0m.com/202209281510146.png" data-thumbnail="https://image.p1nant0m.com/202209281510146.png" data-sub-html="<h2>docker ps å‘½ä»¤æŸ¥çœ‹è¿è¡Œçš„â€œèŠ‚ç‚¹â€</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://image.p1nant0m.com/202209281510146.png"
            data-srcset="https://image.p1nant0m.com/202209281510146.png, https://image.p1nant0m.com/202209281510146.png 1.5x, https://image.p1nant0m.com/202209281510146.png 2x"
            data-sizes="auto"
            alt="https://image.p1nant0m.com/202209281510146.png" />
    </a><figcaption class="image-caption">docker ps å‘½ä»¤æŸ¥çœ‹è¿è¡Œçš„â€œèŠ‚ç‚¹â€</figcaption>
    </figure>
<p><strong>å®¹å™¨ä¸­ä»£ç†æœåŠ¡çš„é…ç½®</strong></p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå—é™äºå›½å†…ç½‘ç»œç¯å¢ƒæƒ…å†µï¼Œè®¸å¤šé•œåƒåœ¨æ‹‰å–æ—¶ä¼šå‡ºç°é—®é¢˜ï¼Œè¿™å°†å¯¼è‡´ Kubernetes éƒ¨ç½²ä¸€äº› Pod çš„æ—¶å€™ä¼šå‡ºç°ç»å¸¸å¤±è´¥çš„æƒ…å†µã€‚å› æ­¤ï¼Œæˆ‘åœ¨ Systemd å¯åŠ¨ Docker å®ˆæŠ¤è¿›ç¨‹çš„ç›¸å…³é…ç½®ä¸­å¢åŠ äº†ç›¸å…³çš„ä»£ç†é…ç½®å†…å®¹ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒ <a href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy" target="_blank" rel="noopener noreffer ">HTTP/HTTPS proxy</a> ï¼Œè¿™æ ·ä¾¿å¯ä»¥åœ¨ Docker å®¹å™¨å†…æ³¨å…¥ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œå®ç°ä»£ç†ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ <code>kind load</code> å‘½ä»¤å‘ç›¸å…³å®¹å™¨ä¸­åŠ è½½æŒ‡å®šçš„é•œåƒï¼Œä½†æ˜¯è¿™ç§æ–¹å¼åœ¨ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ä¸‹æ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥è¯•è¯•ã€‚</p>
<div class="details admonition warning">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>ä»£ç†çš„é—®é¢˜<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>å½“ä½ é€‰æ‹©ä»£ç†åï¼Œä¼šå‡ºç°éå¸¸å¤šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œè¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯å› ä¸ºä»£ç†ç½‘ç»œä¸é›†ç¾¤ç½‘ç»œçš„åŸå› ã€‚</p>
<p>ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„ä¾‹å­æ˜¯è®¿é—®æŸäº› Pod å®¹å™¨ä¸­è¿›ç¨‹æš´éœ²çš„å¥åº·çŠ¶æ€æ£€æµ‹æ¢é’ˆ REST API æ¥å£ã€‚å› ä¸ºä»£ç†çš„åŸå› ï¼Œä½ å¾ˆæœ‰å¯èƒ½è®¿é—®ä¸åˆ°ç›¸å…³èµ„æºçš„è·¯å¾„ï¼Œä»è€Œå¯¼è‡´è¶…æ—¶ï¼Œè¿›è€Œ k8s ä¼šæ ¹æ®ç›¸å…³çš„ç­–ç•¥å»é‡å¯ç›¸å…³çš„æœåŠ¡ï¼Œå¦‚æ­¤åå¤ã€‚</p>
</div>
        </div>
    </div>
<h4 id="å®‰è£…-cilium-cli-ç»ˆç«¯å¹¶åœ¨é›†ç¾¤ä¸­éƒ¨ç½²-cilium">å®‰è£… Cilium CLI ç»ˆç«¯å¹¶åœ¨é›†ç¾¤ä¸­éƒ¨ç½² Cilium</h4>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥éœ€è¦å®‰è£… Cilium çš„ CLI äºŒè¿›åˆ¶ç¨‹åºï¼Œè¯¥ç¨‹åºç”¨äºæä¾›è‡ªåŠ¨åœ¨ k8s é›†ç¾¤ä¸­éƒ¨ç½²å®‰è£… Cilium æä¾›çš„ CNI å®ç°ä»¥åŠèƒ½å¤Ÿæ£€æŸ¥ Cilium çš„å®‰è£…çŠ¶æ€ï¼Œå¯åœç›¸å…³ç‰¹æ€§ç­‰åŠŸèƒ½ã€‚å‡ºäºå®‰å…¨åŸå› çš„è€ƒè™‘ï¼Œä½ å¯ä»¥å‚è€ƒ<a href="https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#install-the-cilium-cli" target="_blank" rel="noopener noreffer ">å®˜æ–¹æ–‡æ¡£</a>æ¥å®Œæˆæ­¤æ­¥éª¤çš„å®‰è£…ã€‚</p>
<p>åœ¨ Cilium éƒ¨ç½²ç›¸å…³ç»„ä»¶æ—¶ï¼Œæ‰§è¡Œç›¸å…³å‘½ä»¤çš„è¿›ç¨‹ä¼šé˜»å¡ç­‰å¾… k8s é›†ç¾¤å®Œæˆç»„ä»¶çš„éƒ¨ç½²ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€ä¸ªå‘½ä»¤è¡Œç»ˆç«¯ä¸­æ‰§è¡Œ <code>kubectl get pods --all-namespace -w</code> æ¥å®æ—¶æŸ¥çœ‹ç›¸å…³è¿›åº¦ã€‚</p>
<div class="details admonition tip">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>éƒé—·<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">k8s åœ¨ç›¸å…³èŠ‚ç‚¹æ‹‰å– YAML æ–‡ä»¶ä¸­æŒ‡å®šçš„é•œåƒæ—¶å¹¶æ²¡æœ‰èƒ½å¤Ÿæ˜¾ç¤ºæ‹‰å–è¿›åº¦çš„åœ°æ–¹ï¼Œæœ‰æ—¶å€™éƒ½ä¸çŸ¥é“ç½‘ç»œæ˜¯ä¸æ˜¯æ­£å¸¸çš„ï¼Œåªèƒ½ç­‰åˆ°å®ƒå¤±è´¥æˆ–æ˜¯æˆåŠŸï¼Œå¿ƒé‡Œæ²¡åº•ï¼Œæœ‰ç‚¹æ…Œã€‚</div>
        </div>
    </div>
<p>ä¸€åˆ‡éƒ½æ­£å¸¸æ‰§è¡Œå®Œæ¯•åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>cilium status</code> å‘½ä»¤æ¥æŸ¥çœ‹é›†ç¾¤ä¸­ Cilium çš„çŠ¶æ€ï¼Œ</p>
<figure><a class="lightgallery" href="https://image.p1nant0m.com/202209281537611.png" title="https://image.p1nant0m.com/202209281537611.png" data-thumbnail="https://image.p1nant0m.com/202209281537611.png" data-sub-html="<h2>cilium status å‘½ä»¤æ‰§è¡Œ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://image.p1nant0m.com/202209281537611.png"
            data-srcset="https://image.p1nant0m.com/202209281537611.png, https://image.p1nant0m.com/202209281537611.png 1.5x, https://image.p1nant0m.com/202209281537611.png 2x"
            data-sizes="auto"
            alt="https://image.p1nant0m.com/202209281537611.png" />
    </a><figcaption class="image-caption">cilium status å‘½ä»¤æ‰§è¡Œ</figcaption>
    </figure>
<h4 id="å¯ç”¨-hubble-ui">å¯ç”¨ Hubble UI</h4>
<p>Hubble æ˜¯ Cilium é¡¹ç›®çš„å¯è§‚æµ‹å±‚ï¼Œå®ƒå¯ä»¥ç”¨æ¥è·å–é›†ç¾¤èŒƒå›´å†…åœ¨ç½‘ç»œä»¥åŠå®‰å…¨å±‚é¢çš„å¯è§‚æµ‹æ€§ï¼Œä»è€Œä¸ºè¿ç»´äººå‘˜æä¾›è¿›è¡Œæ’éšœå·¥ä½œçš„ä¿¡æ¯ä¾æ®ã€‚</p>
<p>æ‰§è¡Œ <code>cilium hubble enable --ui</code> å¯ç”¨ <strong>hubble UI</strong> ç‰¹æ€§ï¼ŒCilium å°†ä¼šé€šè¿‡ Patch cilium-confgã€é‡å¯ Cilium Pods ã€éƒ¨ç½² Hubble UI ç›¸å…³ç»„ä»¶çš„æ–¹å¼æ¥å¯ç”¨ç›¸å…³æœåŠ¡ï¼Œæœ€ç»ˆéƒ¨ç½²æ‰§è¡Œå®Œæˆåæ‰§è¡Œ <code>cilium hubble ui</code> å‘½ä»¤å°†ç›¸å…³æœåŠ¡æ˜ å°„åˆ°æˆ‘ä»¬æœ¬åœ°çš„ç«¯å£ä¸Šï¼Œè®¿é—®ç›¸å…³é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° hubble-ui ä¸æœåŠ¡å¥åº·æ£€æµ‹æ¢é’ˆä¹‹é—´é€šä¿¡çš„æ•°æ®æµã€‚</p>
<figure><a class="lightgallery" href="https://image.p1nant0m.com/202209281620041.png" title="https://image.p1nant0m.com/202209281620041.png" data-thumbnail="https://image.p1nant0m.com/202209281620041.png" data-sub-html="<h2>Hubble UI å‰ç«¯é¡µé¢</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://image.p1nant0m.com/202209281620041.png"
            data-srcset="https://image.p1nant0m.com/202209281620041.png, https://image.p1nant0m.com/202209281620041.png 1.5x, https://image.p1nant0m.com/202209281620041.png 2x"
            data-sizes="auto"
            alt="https://image.p1nant0m.com/202209281620041.png" />
    </a><figcaption class="image-caption">Hubble UI å‰ç«¯é¡µé¢</figcaption>
    </figure>
<h4 id="éƒ¨ç½²ä¸€äº›ç®€å•çš„-workload-star-wars-demoå¹¶åœ¨-hubble-ui-ä¸­è§‚å¯Ÿç½‘ç»œæµ">éƒ¨ç½²ä¸€äº›ç®€å•çš„ Workload ï¼ˆStar Wars Demoï¼‰å¹¶åœ¨ Hubble UI ä¸­è§‚å¯Ÿç½‘ç»œæµ</h4>
<p>Cilium å®˜æ–¹æ–‡æ¡£ä¸­æä¾›äº†ä¸€äº›ç¤ºä¾‹ Demo å±•ç¤º Cilium åŸºäºèº«ä»½å’Œ HTTP çš„ç­–ç•¥æ‰§è¡Œï¼Œå…¶ä¸­ä¸€ä¸ª Demo ä¾¿æ˜¯ Star Wars â­ã€‚æ ¹æ® <a href="https://docs.cilium.io/en/stable/gettingstarted/http/#deploy-the-demo-application" target="_blank" rel="noopener noreffer ">Docs</a> é‡Œçš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿéƒ¨ç½²è¿™æ ·çš„ Demo Workloadã€‚å®˜æ–¹ç»™å‡ºçš„ Demo åº”ç”¨æ‹“æ‰‘ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œ</p>
<figure><a class="lightgallery" href="https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png" title="https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png" data-thumbnail="https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png" data-sub-html="<h2>åº”ç”¨æ‹“æ‰‘ç»“æ„å›¾</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png"
            data-srcset="https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png, https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png 1.5x, https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png 2x"
            data-sizes="auto"
            alt="https://docs.cilium.io/en/stable/_images/cilium_http_gsg.png" />
    </a><figcaption class="image-caption">åº”ç”¨æ‹“æ‰‘ç»“æ„å›¾</figcaption>
    </figure>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨è¿™å‡ ä¸ªæœåŠ¡çš„ REST API æ¥å£æ¥äº§ç”Ÿç›¸åº”çš„ç½‘ç»œæµé‡ï¼Œæ¯”å¦‚åœ¨ xwing Pod ä¸­è°ƒç”¨ <code>kubectl exec xwing -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing</code> å‘ <code>deathstar</code> æœåŠ¡çš„ <code>/v1/request-landing</code> æ¥å£å‘å‡ºé™è½è¯·æ±‚ï¼Œè¯¥æœåŠ¡ä¼šå°†è¯¥è¯·æ±‚è½¬å‘ç»™ç›¸åº”çš„åç«¯ Pod å¤„ç†ã€‚</p>
<p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ tierfighter ä¸­æ‰§è¡Œç›¸ä¼¼çš„å‘½ä»¤ï¼Œ<code>kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing</code>ï¼Œå…¶æ•ˆæœä¸ä¸Šä¸€ä¸ªä¾‹å­ç›¸ä¼¼ã€‚æˆ‘ä»¬èƒ½å¤Ÿåœ¨ hubble-ui çš„ default å‘½åç©ºé—´ä¸‹çœ‹åˆ°ç›¸å…³ Pod çš„ç½‘ç»œæµé‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ</p>
<figure><a class="lightgallery" href="https://image.p1nant0m.com/202209281648078.png" title="https://image.p1nant0m.com/202209281648078.png" data-thumbnail="https://image.p1nant0m.com/202209281648078.png" data-sub-html="<h2>default å‘½åç©ºé—´ä¸‹ Pods é—´çš„ç½‘ç»œæµé‡</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://image.p1nant0m.com/202209281648078.png"
            data-srcset="https://image.p1nant0m.com/202209281648078.png, https://image.p1nant0m.com/202209281648078.png 1.5x, https://image.p1nant0m.com/202209281648078.png 2x"
            data-sizes="auto"
            alt="https://image.p1nant0m.com/202209281648078.png" />
    </a><figcaption class="image-caption">default å‘½åç©ºé—´ä¸‹ Pods é—´çš„ç½‘ç»œæµé‡</figcaption>
    </figure>
<p>ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¥‡æ€ªçš„åœ°æ–¹ï¼Œç›Ÿå†›çš„ xwing æˆ˜æœºç«Ÿç„¶èƒ½å¤Ÿè½åˆ°å¸å›½çš„ deathstar ä¸Šï¼è¿™é‡Œæˆ‘ä»¬ä¾¿å¼•å‡ºæœ¬æ–‡åç»­çš„å†…å®¹ï¼Œä½¿ç”¨ Cilium å¯¹ç½‘ç»œæµé‡è¿›è¡Œ Policy Enforementã€‚</p>
<h4 id="ä½¿ç”¨-cilium-å¯¹-layer-3-4-7-æµé‡è¿›è¡Œæ§åˆ¶">ä½¿ç”¨ Cilium å¯¹ Layer 3, 4, 7 æµé‡è¿›è¡Œæ§åˆ¶</h4>
<p>æ‰€æœ‰çš„ Pod åœ¨ Cilium ä¸­éƒ½è¡¨ç¤ºä¸ºä¸€ä¸ª Endpointï¼Œæˆ‘ä»¬åœ¨ Cilium Pod ä¸Šæ‰§è¡Œ <code>cilium</code> å·¥å…·å»å°†é›†ç¾¤ä¸­ Endpoints ç½—åˆ—å‡ºæ¥ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ kubectl -n kube-system <span class="nb">exec</span> cilium-gvmxn -- cilium endpoint list
Defaulted container <span class="s2">&#34;cilium-agent&#34;</span> out of: cilium-agent, mount-cgroup <span class="o">(</span>init<span class="o">)</span>, clean-cilium-state <span class="o">(</span>init<span class="o">)</span>
ENDPOINT   POLICY <span class="o">(</span>ingress<span class="o">)</span>   POLICY <span class="o">(</span>egress<span class="o">)</span>   IDENTITY   LABELS <span class="o">(</span>source:key<span class="o">[=</span>value<span class="o">])</span>                                                         IPv6   IPv4           STATUS
           ENFORCEMENT        ENFORCEMENT

<span class="m">858</span>        Disabled           Disabled          <span class="m">1</span>          k8s:node-role.kubernetes.io/control-plane                                                                 ready
                                                           k8s:node.kubernetes.io/exclude-from-external-load-balancers

                                                           reserved:host

<span class="m">889</span>        Disabled           Disabled          <span class="m">26464</span>      k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>kube-system                 10.244.0.60    ready
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>coredns

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>kube-system

                                                           k8s:k8s-app<span class="o">=</span>kube-dns

<span class="m">982</span>        Disabled           Disabled          <span class="m">28376</span>      k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>kube-system                 10.244.0.36    ready
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>hubble-relay

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>kube-system

                                                           k8s:k8s-app<span class="o">=</span>hubble-relay

<span class="m">1282</span>       Disabled           Disabled          <span class="m">5963</span>       k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>kube-system                 10.244.0.151   ready
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>hubble-ui

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>kube-system

                                                           k8s:k8s-app<span class="o">=</span>hubble-ui

<span class="m">1610</span>       Disabled           Disabled          <span class="m">26464</span>      k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>kube-system                 10.244.0.19    ready
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>coredns

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>kube-system

                                                           k8s:k8s-app<span class="o">=</span>kube-dns

<span class="m">1758</span>       Disabled           Disabled          <span class="m">9328</span>       k8s:app.kubernetes.io/name<span class="o">=</span>xwing
                              10.244.0.95    ready
                                                           k8s:class<span class="o">=</span>xwing

                                                           k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>default
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>default

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>default

                                                           k8s:org<span class="o">=</span>alliance

<span class="m">2090</span>       Disabled           Disabled          <span class="m">21851</span>      k8s:app.kubernetes.io/name<span class="o">=</span>deathstar
                              10.244.0.72    ready
                                                           k8s:class<span class="o">=</span>deathstar

                                                           k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>default
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>default

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>default

                                                           k8s:org<span class="o">=</span>empire

<span class="m">2319</span>       Disabled           Disabled          <span class="m">4</span>          reserved:health
                              10.244.0.209   ready
<span class="m">2349</span>       Disabled           Disabled          <span class="m">21851</span>      k8s:app.kubernetes.io/name<span class="o">=</span>deathstar
                              10.244.0.169   ready
                                                           k8s:class<span class="o">=</span>deathstar

                                                           k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>default
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>default

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>default

                                                           k8s:org<span class="o">=</span>empire

<span class="m">2579</span>       Disabled           Disabled          <span class="m">13871</span>      k8s:app.kubernetes.io/name<span class="o">=</span>tiefighter
                              10.244.0.240   ready
                                                           k8s:class<span class="o">=</span>tiefighter

                                                           k8s:io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name<span class="o">=</span>default
                                                           k8s:io.cilium.k8s.policy.cluster<span class="o">=</span>kind-kind

                                                           k8s:io.cilium.k8s.policy.serviceaccount<span class="o">=</span>default

                                                           k8s:io.kubernetes.pod.namespace<span class="o">=</span>default
</code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ä¸Šè¿° Pod ä¸­å¹¶æ²¡æœ‰å¯¹ Ingress æˆ– Egress å‘æµé‡è¿›è¡Œ Policy Enforcementï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å°±æ˜¯è¦å»åˆ›å»ºå¯¹åº”çš„ Policyï¼Œå®ç°æˆ‘ä»¬å¯¹ä¸‰å±‚ã€å››å±‚ä»¥åŠä¸ƒå±‚æµé‡çš„æ§åˆ¶ã€‚</p>
<h5 id="åº”ç”¨-l3l4-å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥">åº”ç”¨ L3/L4 å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥</h5>
<p>ä½¿ç”¨ Cilium ä¸ Kubernetes éƒ¨ç½² L4 ç½‘ç»œç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨åˆ›å»º Pod æ—¶ä¸ºå®ƒä»¬æŒ‡å®šçš„æ ‡ç­¾æ¥æ„å»ºæˆ‘ä»¬çš„å®‰å…¨ç­–ç•¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦çŸ¥é“å®ƒä»¬åˆ°åº•å…·ä½“ Pod è¿è¡Œåœ¨é›†ç¾¤çš„å“ªä¸€ä¸ªç½‘ç»œä½ç½®åœ¨ä½•æ—¶è¿è¡Œäº†ã€‚è¿™æä¾›äº†ä¸€å±‚æŠ½è±¡ï¼Œè®©ç”¨æˆ·åªéœ€è¦å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å¯¹åº•å±‚çš„ç»†èŠ‚è¿›è¡Œè¿‡å¤šçš„å¹²é¢„æˆ–æ“å¿ƒï¼ŒKubernetes ä¼šä¸ºæˆ‘ä»¬å‡†å¤‡å¥½ä¸€åˆ‡ï¼</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸Šè¿°æˆ‘ä»¬ç”¨åˆ°çš„æ˜Ÿæˆ˜ä¾‹å­ä¸­ï¼Œxwing Pod ä¸­æˆ‘ä»¬æ·»åŠ äº†æ ‡ç­¾ <code>class=xwing org=alliance</code>ï¼Œè€Œåœ¨ tierfighter Pod ä¸­æˆ‘ä»¬çš„æ ‡ç­¾åˆ™æ˜¯ <code>class=tiefighter org=empire</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–å†™å®‰å…¨ç­–ç•¥æ—¶ç›´æ¥ä½¿ç”¨è¿™äº›æ ‡ç­¾ï¼ŒKubernetes å’Œ Cilium ä¼šå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°å¯¹åº”çš„åç«¯ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºçš„æ˜¯æˆ‘ä»¬æƒ³è¦è¾¾æˆçš„ç›®æ ‡ï¼Œ</p>
<figure><a class="lightgallery" href="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png" title="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png" data-thumbnail="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png" data-sub-html="<h2>xwing æˆ˜æœºä¸èƒ½é™è½åœ¨æ­»æ˜Ÿä¸Šï¼</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png"
            data-srcset="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png, https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png 1.5x, https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png 2x"
            data-sizes="auto"
            alt="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_gsg.png" />
    </a><figcaption class="image-caption">xwing æˆ˜æœºä¸èƒ½é™è½åœ¨æ­»æ˜Ÿä¸Šï¼</figcaption>
    </figure>
<p>ä¸ºäº†è¾¾æˆæˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ <strong>CiliumNetworkPolicy</strong> å®ç°ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;cilium.io/v2&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">CiliumNetworkPolicy</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;rule1&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;L3-L4 policy to restrict deathstar access to empire ships only&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">endpointSelector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">org</span><span class="p">:</span><span class="w"> </span><span class="l">empire</span><span class="w">
</span><span class="w">      </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l">deathstar</span><span class="w">
</span><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">fromEndpoints</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">org</span><span class="p">:</span><span class="w"> </span><span class="l">empire</span><span class="w">
</span><span class="w">    </span><span class="nt">toPorts</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;80&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°è§„åˆ™æ˜¯ä¸€ä¸ªç™½åå•è§„åˆ™ï¼Œå…¶ä»…å…è®¸æ ‡ç­¾ä¸º <code>org:empire</code> çš„ Pod é€šè¿‡ TCP åè®®è®¿é—®å…·æœ‰æ ‡ç­¾ <code>org:empire class:deathstar</code> Endpoint çš„ 80 ç«¯å£ï¼Œå…¶å®ƒä¸ç¬¦åˆè§„åˆ™çš„å…¥å‘æµé‡éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚è¿™æ ·æˆ‘ä»¬ä¾¿å®ç°äº† L3/L4 çš„ Policy Enforcement.</p>
<p>åœ¨ Hubble UI ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”± Pod xwing å‘å‡ºçš„æµé‡è¢« Pod deathstar ä¸¢å¼ƒï¼Œ</p>
<figure><a class="lightgallery" href="https://image.p1nant0m.com/202209281930575.png" title="https://image.p1nant0m.com/202209281930575.png" data-thumbnail="https://image.p1nant0m.com/202209281930575.png" data-sub-html="<h2>Policy Enforement ä¸¢å¼ƒç›¸å…³æ•°æ®åŒ…</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://image.p1nant0m.com/202209281930575.png"
            data-srcset="https://image.p1nant0m.com/202209281930575.png, https://image.p1nant0m.com/202209281930575.png 1.5x, https://image.p1nant0m.com/202209281930575.png 2x"
            data-sizes="auto"
            alt="https://image.p1nant0m.com/202209281930575.png" />
    </a><figcaption class="image-caption">Policy Enforement ä¸¢å¼ƒç›¸å…³æ•°æ®åŒ…</figcaption>
    </figure>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ­¤æ‰§è¡Œä¸Šé¢æåˆ°çš„æŸ¥çœ‹ Cilium Endpoint çš„å‘½ä»¤ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å‘ç° deathstar Pod ä¸­ Ingress Policy Enforcement è¢«æ¿€æ´»ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰§è¡Œ <code>kubectl describe cnp</code> æ¥æŸ¥çœ‹ç›¸å…³çš„ CiliumNetworkPolicy è§„åˆ™ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kubectl describe cnp
Name:         rule1
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  cilium.io/v2
Kind:         CiliumNetworkPolicy
Metadata:
  Creation Timestamp:  2022-09-28T11:27:31Z
  Generation:          <span class="m">1</span>
  Managed Fields:
    API Version:  cilium.io/v2
    Fields Type:  FieldsV1
    fieldsV1:
      f:spec:
        .:
        f:description:
        f:endpointSelector:
          .:
          f:matchLabels:
            .:
            f:class:
            f:org:
        f:ingress:
    Manager:         kubectl-create
    Operation:       Update
    Time:            2022-09-28T11:27:31Z
  Resource Version:  <span class="m">21081</span>
  UID:               5c405d24-b059-4992-8250-f9963a42858b
Spec:
  Description:  L3-L4 policy to restrict deathstar access to empire ships only
  Endpoint Selector:
    Match Labels:
      Class:  deathstar
      Org:    empire
  Ingress:
    From Endpoints:
      Match Labels:
        Org:  empire
    To Ports:
      Ports:
        Port:      <span class="m">80</span>
        Protocol:  TCP
Events:            &lt;none&gt;
</code></pre></td></tr></table>
</div>
</div><h5 id="åº”ç”¨-l7-å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥">åº”ç”¨ L7 å±‚ç½‘ç»œå®‰å…¨ç­–ç•¥</h5>
<p>æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦æ›´åŠ ç»†ç²’åº¦çš„è§„åˆ™å»è¿›è¡Œè¿‡æ»¤ï¼ŒL3/L4 å±‚ä¸­çš„è¯­ä¹‰ç›¸å¯¹æ¥è¯´æ›´åŠ åå‘åº•å±‚ä¸”ä¸åº”ç”¨æœ¬èº«æ— å…³ï¼Œè€Œ L7 å±‚çš„æŠ¥æ–‡ä¿¡æ¯å…·æœ‰æ›´åŠ ä¸°å¯Œçš„è¯­ä¹‰å¹¶ä¸”ä¸åº”ç”¨ç›¸å…³ï¼Œå¯¹ L7 å±‚è¿›è¡Œå®‰å…¨è®¿é—®æ§åˆ¶èƒ½å¤Ÿå–å¾—æ›´å¥½çš„é˜²æŠ¤æ•ˆæœã€åŒæ—¶ä¹Ÿèƒ½å¤Ÿé’ˆå¯¹ä¸åŒçš„åº”ç”¨ã€ä¸åŒçš„ä½¿ç”¨åœºæ™¯æ¥è¿›è¡Œä¸ªæ€§åŒ–éœ€æ±‚å®šåˆ¶ï¼Œç»™ç”¨æˆ·æ›´åŠ ä¸°å¯Œå¤šæ ·çš„é€‰æ‹©ã€‚</p>
<p>å›åˆ°æˆ‘ä»¬åœ¨ Star War ä¸­çš„ä¾‹å­ï¼Œå‡è®¾ç°åœ¨ deathstar ä¸­æœ‰ä¸€ä¸ª api <code>/v1/exhaust-port</code>ï¼Œå®ƒèƒ½å¤Ÿè®©æ­»æ˜Ÿçˆ†ç‚¸ğŸ’£ï¼å¯¹å…¶è¿›è¡Œè®¿é—®éœ€è¦è¿›è¡Œä¸¥æ ¼çš„è®¿é—®æ§åˆ¶ï¼Œå¹¶ä¸æ˜¯ä»»ä½•å¸å›½é£èˆ¹éƒ½èƒ½å¤Ÿå‘å‡ºè¯·æ±‚å¹¶æˆåŠŸå“åº”çš„ï¼å¦‚æœä¸å¯¹å…¶è¿›è¡Œä»»ä½•é™åˆ¶ï¼Œå¯èƒ½ä¼šæœ‰ä¸‹é¢çš„æ‚²å‰§å‘ç”Ÿï¼ˆç›Ÿå†›å¯è¦é«˜å…´åäº†ï¼ï¼‰ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kubectl <span class="nb">exec</span> tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port
Panic: deathstar exploded

goroutine <span class="m">1</span> <span class="o">[</span>running<span class="o">]</span>:
main.HandleGarbage<span class="o">(</span>0x2080c3f50, 0x2, 0x4, 0x425c0, 0x5, 0xa<span class="o">)</span>
        /code/src/github.com/empire/deathstar/
        temp/main.go:9 +0x64
main.main<span class="o">()</span>
        /code/src/github.com/empire/deathstar/
        temp/main.go:5 +0x85
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ <strong>CiliumNetworkPolicy</strong>ï¼Œ æˆ‘ä»¬æœ€ç»ˆéœ€è¦è¾¾æˆä¸‹å›¾æ‰€ç¤ºçš„ç›®æ ‡ï¼Œ</p>
<figure><a class="lightgallery" href="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png" title="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png" data-thumbnail="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png" data-sub-html="<h2>å®‰å…¨ç­–ç•¥çš„ç›®æ ‡</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png"
            data-srcset="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png, https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png 1.5x, https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png 2x"
            data-sizes="auto"
            alt="https://docs.cilium.io/en/stable/_images/cilium_http_l3_l4_l7_gsg.png" />
    </a><figcaption class="image-caption">å®‰å…¨ç­–ç•¥çš„ç›®æ ‡</figcaption>
    </figure>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹è¿°ç­–ç•¥è¿›è¡Œ L7 å±‚çš„è®¿é—®æ§åˆ¶ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;cilium.io/v2&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">CiliumNetworkPolicy</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;rule1&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;L7 policy to restrict access to specific HTTP call&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">endpointSelector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">org</span><span class="p">:</span><span class="w"> </span><span class="l">empire</span><span class="w">
</span><span class="w">      </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l">deathstar</span><span class="w">
</span><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">fromEndpoints</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">org</span><span class="p">:</span><span class="w"> </span><span class="l">empire</span><span class="w">
</span><span class="w">    </span><span class="nt">toPorts</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;80&#34;</span><span class="w">
</span><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">      </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;POST&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/v1/request-landing&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ç­–ç•¥å¯¹å¸¦æœ‰ <code>org:empire</code> æ ‡ç­¾çš„ Pod èƒ½å¯¹ <code>org:empire class:deathstar</code> çš„ Pod è¿›è¡Œçš„æ“ä½œåšå‡ºäº†é™åˆ¶ï¼Œç¬¦åˆç›®æ ‡çš„ Pod åªèƒ½å¤Ÿé€šè¿‡ HTTP POST æ–¹æ³•è®¿é—®ç›®çš„ Pod ï¼ˆDeathstarï¼‰çš„ <code>/v1/request-landing</code> æ¥å£ã€‚</p>
<p>æˆ‘ä»¬å†æ¬¡è®¿é—® Service çš„ <code>/v1/request-landing</code> æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™æ¬¡çš„è¯·æ±‚è¢«æ‹’ç»äº†ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ kubectl <span class="nb">exec</span> tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port
Access denied
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¾¿æ˜¯ç®€å•ä½¿ç”¨ Cilium è¿›è¡Œ L3/L4ã€L7 å±‚è®¿é—®æ§åˆ¶çš„ç¤ºä¾‹ï¼Œä»¥åŠæˆ‘ä»¬èƒ½å¤Ÿä» Hubble UI ä¸­è·å¾—ç›¸å…³çš„æ•°æ®ä¿¡æ¯ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>Cilium ä½¿ç”¨ eBPF æŠ€æœ¯å®ç° CNI ç½‘ç»œæ’ä»¶ï¼Œå¹¶ä¸”åˆ©ç”¨ eBPF åœ¨å®‰å…¨æ–¹é¢çš„èƒ½åŠ›ï¼Œå®ç°ç”¨æˆ·è‡ªå®šä¹‰ç­–ç•¥çš„ Policy Enforcementï¼Œè¿™è®©äººä»¬çœ‹åˆ° eBPF åœ¨ç½‘ç»œä¸å®‰å…¨æ–¹é¢çš„å·¨å¤§æ½œèƒ½ã€‚ä¸è¿‡ï¼ŒCilium é¡¹ç›®æœ¬èº«è¿˜æœ‰è®¸å¤šå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸Šè¿°çš„ Hubble UI ä¸­çœ‹åˆ°çš„æ•°æ®ç»´åº¦è¿˜æ˜¯ç›¸å¯¹æ¥è¯´è¾ƒä¸ºå•ä¸€çš„ï¼Œåªèƒ½çœ‹è§æ•°æ®åŒ…çš„ç«¯åˆ°ç«¯çš„æµå‘è€Œæ— æ³•çœ‹åˆ°å…¶ä¸­çš„è½½è·ä¿¡æ¯ï¼Œä¹Ÿä¸èƒ½é€šè¿‡å‰ç«¯è¿ç»´é¢æ¿æˆ– dashboard çš„å½¢å¼å®æ—¶ä¸‹å‘ç­–ç•¥ã€‚å¦å¤–ï¼Œåœ¨å®‰å…¨ç­–ç•¥ç¼–å†™æ–¹é¢çš„å¯æ‰©å±•æ€§å’Œè¯­ä¹‰ä»è¾ƒä¸ºç®€å•ï¼Œç¼–å†™å…·æœ‰ä¸°å¯Œå®‰å…¨ä¸Šä¸‹æ–‡ä¿¡æ¯çš„å®‰å…¨ç­–ç•¥å—é™ï¼ˆå¯ä»¥çœ‹çœ‹ OPAï¼Œæˆ–è€…cel-goï¼Ÿï¼‰ã€‚</p>
<p>ç¬”è€…è®¤ä¸ºåœ¨äº‘åŸç”Ÿç¯å¢ƒä¸‹ï¼Œæ¶æ„çš„å¤æ‚æ€§ä»¥åŠé€šä¿¡çš„æµé‡çš„çºµæ¨ªäº¤é”™æœ¬èº«å°±ä¼šç»™ç³»ç»Ÿçš„è§‚æµ‹å’Œç»´æŠ¤å¸¦æ¥æŒ‘æˆ˜ï¼Œä½†äºæ­¤åŒæ—¶ä¹Ÿä¼šå¸¦æ¥å·¨å¤§çš„ä¸Šä¸‹æ–‡ç¯å¢ƒè¯­ä¹‰ä¿¡æ¯ï¼Œä¸šç•Œå¯¹äºå¯è§‚æµ‹æ€§ä¹Ÿæœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼ˆTracingã€Loggingã€Metricï¼‰ï¼Œå®‰å…¨ä½œä¸ºç³»ç»Ÿçš„é‡è¦ä¸€ç¯ï¼Œæœ¬èº«å°±å¯ä»¥å—ç›Šäºå¯è§‚æµ‹æ€§æå‡å¸¦æ¥çš„å¯ä¾›åˆ†æçš„ä¿¡æ¯é‡å¢åŠ ã€‚å¼ºè¯­ä¹‰ã€æ™ºèƒ½çš„ Policy Enforcement ç»“åˆ HIDSã€IASTã€RASP ç­‰å‰æ²¿å®‰å…¨æŠ€æœ¯çš„åº”ç”¨ï¼Œèƒ½å¤Ÿè§£å†³å¤§å¤šæ•°äº‘åŸç”Ÿåº”ç”¨åœºæ™¯ä¸‹çš„è¿è¡Œå®‰å…¨é—®é¢˜ï¼Œèƒ½å¤Ÿç»™è¿ç»´å·¥ç¨‹å¸ˆã€å®‰å…¨å·¥ç¨‹å¸ˆæä¾›å……åˆ†ã€ç²¾ç¡®çš„æ•°æ®å»åˆ†æç›¸å…³çš„å®‰å…¨äº‹ä»¶ï¼Œä»è€Œèƒ½å¤Ÿå°½æ—©è¿›è¡Œç ”åˆ¤ã€å°å µï¼Œå½¢æˆå®‰å…¨äº‹ä»¶é—­ç¯ã€‚</p>
<p>å¹³å°å±‚åº”ç”¨é™¤äº†æä¾›æ•°æ®çš„é‡‡é›†ã€èšåˆ/èšç±»ã€å…³è”ã€å¯è§†åŒ–ã€æŒä¹…åŒ–ä¹‹å¤–ï¼Œè¿˜éœ€è¦æä¾›ä¸»åŠ¨çš„æ‰‹æ®µï¼Œå¯¹ç›¸å…³è¡Œä¸ºè¿›è¡Œååˆ¶ã€‚è­¬å¦‚å¯¹å®æ—¶çš„å…¥ä¾µè€…è¿›è¡Œçƒ­åŠ¨æ€èœœç½è¿ç§»ã€èº«ä»½å®ä½“å°ç¦ï¼ŒåŒ–è¢«åŠ¨å®‰å…¨ä¸ºä¸»åŠ¨å®‰å…¨ã€‚</p>
<div class="details admonition note">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>çŒœæƒ³<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>eBPF ä¸ç½‘ç»œç›¸å…³çš„ç¨‹åºä¸­æœ‰ XDP å’Œ TC ç±»åˆ«ï¼ŒTC ç¨‹åºèƒ½å¤Ÿè®¿é—®å†…æ ¸çš„è·¯ç”±è¡¨ï¼Œä»è€Œå†³å®šæ•°æ®åŒ…å‘å‡ºçš„æ–¹å‘ï¼Œä½¿ç”¨ eBPF æŠ€æœ¯å¯ä»¥å®ç° LoadBalancerï¼Œå¯¹ L3/L4 å±‚æµé‡è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œè¿™æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¶æ„ä¸­çš„ä½¿ç”¨ã€‚</p>
<p>åœ¨å®‰å…¨æ–¹æ¡ˆï¼Œè¿™ç§åŠ¨æ€ä½æˆæœ¬çš„ç½‘ç»œâ€œæ”¹é“â€èƒ½åŠ›ä¼¼ä¹å¾ˆé€‚åˆç”¨ä½œèœœç½ï¼Œäº‘åŸç”Ÿç¯å¢ƒä¸‹å¯ä»¥å¿«é€Ÿéƒ¨ç½²ä¸€ä¸ªå®¹å™¨ç¯å¢ƒï¼Œå¹¶å°†è¢«æ ‡è®°çš„ç›¸å…³æµé‡ç‰µå¼•äºæ­¤ï¼Œç”±äºæ˜¯èœœç½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢åŠ è½½å°½å¯èƒ½å¤šçš„æ¢é’ˆï¼Œå°½å¯èƒ½ç²¾ç¡®çš„æ•è·æ”»å‡»è€…çš„è¡Œä¸ºå›¾è°±ï¼Œä»è€Œå‘ç°ä¸šåŠ¡ä»£ç çš„æ¼æ´ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒåŠæ—¶çš„ä¿®å¤å’Œå¤„ç†ã€‚</p>
</div>
        </div>
    </div>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2022-09-27</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://p1nant0m.com/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" data-title="åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble" data-via="p1nant0m" data-hashtags="eBPF,kubernetes,cilium"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://p1nant0m.com/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" data-hashtag="eBPF"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Hacker News" data-sharer="hackernews" data-url="https://p1nant0m.com/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" data-title="åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://p1nant0m.com/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" data-title="åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://p1nant0m.com/2022-09-28-%E5%9C%A8k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2cilium%E4%B8%8Ehubble/" data-title="åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Cilium ä¸ Hubble"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ebpf/">eBPF</a>,&nbsp;<a href="/tags/kubernetes/">kubernetes</a>,&nbsp;<a href="/tags/cilium/">cilium</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2022-09-26-golang-%E9%9D%A2%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%AD%A6%E4%B9%A0.zh-ch/" class="prev" rel="prev" title="Golang é¢è¯•é©±åŠ¨å­¦ä¹ "><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Golang é¢è¯•é©±åŠ¨å­¦ä¹ </a>
            <a href="/2022-10-08-%E4%BC%98%E9%9B%85%E7%9A%84%E5%88%9B%E5%BB%BA-cli-%E7%A8%8B%E5%BA%8F.zh-ch/" class="next" rel="next" title="ä¼˜é›…çš„åˆ›å»º CLI ç¨‹åº">ä¼˜é›…çš„åˆ›å»º CLI ç¨‹åº<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">p1nant0m</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":50},"comment":{"valine":{"appId":"UnWumtTxnhlvaMmfKV6lZwUy-gzGzoHsz","appKey":"egg4vgYXZCZTW8f4QbS5bDpL","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-CN","pageSize":10,"placeholder":"ä½ çš„è¯„è®º ...","recordIP":true,"visitor":true}},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"ğŸ™‚P1nant0m","id-2":"ğŸ™‚P1nant0m"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
